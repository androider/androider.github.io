<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>凉凉小线仔</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Android,Java,Python,博客">
<meta property="og:type" content="website">
<meta property="og:title" content="凉凉小线仔">
<meta property="og:url" content="http://andx.site/index.html">
<meta property="og:site_name" content="凉凉小线仔">
<meta property="og:description" content="Android,Java,Python,博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="凉凉小线仔">
<meta name="twitter:description" content="Android,Java,Python,博客">
  
    <link rel="alternate" href="/atom.xml" title="凉凉小线仔" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">凉凉小线仔</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">基于Android 高于Android</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://andx.site"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-2018-12-27-麻花影视会员蓝关分析（方案不可行）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/27/2018-12-27-麻花影视会员蓝关分析（方案不可行）/" class="article-date">
  <time datetime="2018-12-27T06:46:31.000Z" itemprop="datePublished">2018-12-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>►<a class="article-category-link" href="/categories/Android/逆向/">逆向</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/27/2018-12-27-麻花影视会员蓝关分析（方案不可行）/">2018-12-27-麻花影视会员蓝关分析（方案不可行）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这种金币记录一般在后台记录，而蓝关权限的购买也是发生在服务的。所以最好的办法是刷出无线金币来。</p>
<blockquote>
<p><strong>先把结论写在这里，结论是我处理不了，没有办法绕过无服务端的检查，直接请求1080p的播放地址值，但是得到的播放地址的规律上来看，应该是某个东西的md5值，如果能够破解生成算法那么有可能能解决。</strong></p>
</blockquote>
<p>看下他做任务赚金币的过程也只能是每天有次数控制。所以可以模拟请求，尝试下修改日期能不能行，这里行不行就看后台有没有限制了。。。</p>
<p>我们仔细看下这个获取1080p的流程，打开视频，切换清晰度，如果你切换1080 的时候，会先判断当前用户是否有权限观看，如果有,那么请求，如果没有那么提示购买权限，然后就是购买过程了。</p>
<p>我们不走购买流程、能不能直接请求1080 p的播放地址，先来尝试一下。</p>
<p><img src="https://note.youdao.com/yws/public/resource/2aaa20465ab7ce4c8e624e2e5969be9b/xmlnote/3CA6A2F4807449A1A7989674BEEF93FD/2234" alt="切换蓝关的时候，提示是否购买蓝关体验权限"></p>
<p>根据关键字，我们查找一下这个对话框是什么时候弹出来的，我们绕过弹出的代码，直接往下执行，看看行不行。</p>
<p>我们jadx 全局搜索，<code>是否花费</code>，这几个关键字，总共能搜到两处：</p>
<ul>
<li>com.mh.movie.core.mvp.ui.activity.player.PlayerActivity.a(TableCommodity, Integer)</li>
<li>com.mh.movie.core.mvp.ui.activity.TvplayDetailActivity.a(TableCommodity)</li>
</ul>
<p>那根据前面几篇文章的分析，我们知道我们的目标Activity肯定是  PlayerActivity，看下这个a方法的声明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">public void a(final TableCommodity tableCommodity, final Integer num) &#123;</span><br><span class="line">    RequestPermissionDialog requestPermissionDialog;</span><br><span class="line">    if ((com.mh.movie.core.mvp.ui.b.a().getMoney() &gt;= tableCommodity.money ? 1 : null) == null) &#123;</span><br><span class="line">        if (this.B == null) &#123;</span><br><span class="line">            this.B = new RequestPermissionDialog(this.r, 9);</span><br><span class="line">            this.B.a(&quot;提示&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        String format = String.format(&quot;开启%s还需 &quot;, new Object[]&#123;tableCommodity.title&#125;);</span><br><span class="line">        requestPermissionDialog = this.B;</span><br><span class="line">        StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line">        stringBuilder.append(format);</span><br><span class="line">        stringBuilder.append(tableCommodity.money - com.mh.movie.core.mvp.ui.b.a().getMoney());</span><br><span class="line">        stringBuilder.append(&quot; 个麻花币\n您的麻花币不足，无法开启&quot;);</span><br><span class="line">        requestPermissionDialog.b(stringBuilder.toString());</span><br><span class="line">        this.B.d(&quot;做任务赚取&quot;);</span><br><span class="line">        this.B.a(new RequestPermissionDialog.a() &#123;</span><br><span class="line">            public void a() &#123;</span><br><span class="line">                PlayerActivity.this.B.dismiss();</span><br><span class="line">                EventBus.getDefault().post(&quot;msg&quot;, &quot;make_money&quot;);</span><br><span class="line">                PlayerActivity.this.finish();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            public void b() &#123;</span><br><span class="line">                PlayerActivity.this.B.dismiss();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        this.B.show();</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if (this.C == null) &#123;</span><br><span class="line">        this.C = new RequestPermissionDialog(this.r, 8);</span><br><span class="line">        this.C.a(&quot;提示&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    String format2 = String.format(&quot; 麻花币开启%s？&quot;, new Object[]&#123;tableCommodity.title&#125;);</span><br><span class="line">    String format3 = String.format(&quot;个月的%s体验&quot;, new Object[]&#123;tableCommodity.title&#125;);</span><br><span class="line">    RequestPermissionDialog requestPermissionDialog2 = this.C;</span><br><span class="line">    StringBuilder stringBuilder2 = new StringBuilder();</span><br><span class="line">    stringBuilder2.append(&quot;是否花费 &quot;);</span><br><span class="line">    stringBuilder2.append(tableCommodity.money);</span><br><span class="line">    stringBuilder2.append(format2);</span><br><span class="line">    requestPermissionDialog2.b(stringBuilder2.toString());</span><br><span class="line">    requestPermissionDialog = this.C;</span><br><span class="line">    StringBuilder stringBuilder3 = new StringBuilder();</span><br><span class="line">    stringBuilder3.append(&quot;开启后可享受&quot;);</span><br><span class="line">    stringBuilder3.append(tableCommodity.validNum);</span><br><span class="line">    stringBuilder3.append(format3);</span><br><span class="line">    requestPermissionDialog.c(stringBuilder3.toString());</span><br><span class="line">    this.C.a(new RequestPermissionDialog.a() &#123;</span><br><span class="line">        public void a() &#123;</span><br><span class="line">            PlayerActivity.this.C.dismiss();</span><br><span class="line">            ((PlayerPresenter) PlayerActivity.this.b).a(tableCommodity.authId, num);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void b() &#123;</span><br><span class="line">            PlayerActivity.this.C.dismiss();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    this.C.show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们看看啥地方调用了这个方法，在调用这个方法的地方肯定有判断当前用户是不是有播放1080p的权限。我们在这个方法上打上断点，调试观察，这个方法是在哪里调用的。动态调试Smali这里不再做介绍。</p>
<p>断点打在如下方法上：</p>
<p><code>.method public a(Lcom/mh/movie/core/mvp/model/db/TableCommodity;Ljava/lang/Integer;)V</code></p>
<p>观察调用堆栈，省略无用代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a:984, PlayerActivity (com.mh.movie.core.mvp.ui.activity.player)</span><br><span class="line">a:900, PlayerActivity$26 (com.mh.movie.core.mvp.ui.activity.player)</span><br><span class="line">a:944, LandLayoutVideo (com.mh.movie.core.mvp.ui.activity.player)</span><br><span class="line">//省略无用代码</span><br></pre></td></tr></table></figure></p>
<p>发现这方法是在如下类里面调用的：</p>
<p>.class Lcom/mh/movie/core/mvp/ui/activity/player/PlayerActivity$26;</p>
<p>看这个类的原型，也即是这个类的父类或者实现接口：</p>
<p><code>.implements Lcom/mh/movie/core/mvp/ui/activity/player/LandLayoutVideo$b;</code>,看到上面Smali代码里的 PlayerActivity$26 可以知道，这个代码是根据PlayerActivity 里面的地26个匿名对象反汇编得到的。那么他的匿名对象的创建肯定在 PlayerActivity 里面。</p>
<p>去jadx里面的 PlayerActivity  查找和这个接口相关的实现。代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">LandLayoutVideo.b I = new LandLayoutVideo.b() &#123;</span><br><span class="line">        public void a(int i) &#123;</span><br><span class="line">            ((PlayerPresenter) PlayerActivity.this.b).b(i, PlayerActivity.h);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void a() &#123;</span><br><span class="line">            if (!(((PlayerPresenter) PlayerActivity.this.b).i() == -1 || PlayerActivity.o)) &#123;</span><br><span class="line">                PlayerActivity.this.mhVideoPlayer.d(((PlayerPresenter) PlayerActivity.this.b).k());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void b() &#123;</span><br><span class="line">            PlayerActivity.this.mhVideoPlayer.a(((PlayerPresenter) PlayerActivity.this.b).f().getVideoPageList(), ((PlayerPresenter) PlayerActivity.this.b).f().getVideoList(), ((PlayerPresenter) PlayerActivity.this.b).f().getType(), PlayerActivity.this.y);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">//我们额弹出窗就是从这里弹出的。</span><br><span class="line">        public void a(int i, Integer num) &#123;</span><br><span class="line">            if (num == null) &#123;</span><br><span class="line">                PlayerActivity.this.A.b(i);</span><br><span class="line">                ((PlayerPresenter) PlayerActivity.this.b).a(i);</span><br><span class="line">            &#125; else if (d.b(PlayerActivity.this.r, com.mh.movie.core.mvp.ui.b.i)) &#123;</span><br><span class="line">                PlayerActivity.this.a(((PlayerPresenter) PlayerActivity.this.b).c(9), num);</span><br><span class="line">            &#125; else &#123;//从名字上来看这里是要求登录</span><br><span class="line">                com.jess.arms.c.a.a(QuickLoginActivity.class);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void a(VideoListBean videoListBean, int i) &#123;</span><br><span class="line">            ((PlayerPresenter) PlayerActivity.this.b).a(videoListBean, i, true);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void c() &#123;</span><br><span class="line">            MHPlayerLogicView mHPlayerLogicView = PlayerActivity.this.mhVideoPlayer;</span><br><span class="line">            boolean z = true;</span><br><span class="line">            if (((PlayerPresenter) PlayerActivity.this.b).f() == null || ((PlayerPresenter) PlayerActivity.this.b).f().getFavorited() != 1) &#123;</span><br><span class="line">                z = false;</span><br><span class="line">            &#125;</span><br><span class="line">            mHPlayerLogicView.b(z);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void a(boolean z) &#123;</span><br><span class="line">            ((PlayerPresenter) PlayerActivity.this.b).p();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void d() &#123;</span><br><span class="line">            if (((PlayerPresenter) PlayerActivity.this.b).f().getVipFlag() == 1) &#123;</span><br><span class="line">                com.jess.arms.c.a.a(PlayerActivity.this.r, &quot;VIP片源无法分享&quot;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                PlayerActivity.this.b(true);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void e() &#123;</span><br><span class="line">            if (PlayerActivity.o) &#123;</span><br><span class="line">                g.a().a(PlayerActivity.this.mhVideoPlayer.getCurrentPlayer().getCurrentPositionWhenPlaying() / 1000, PlayerActivity.this.Z, PlayerActivity.this.aa);</span><br><span class="line">                PlayerActivity.this.G();</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            ((PlayerPresenter) PlayerActivity.this.b).b(true);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public boolean f() &#123;</span><br><span class="line">            return PlayerActivity.this.o();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>前面我们分析播放器的时候，分析过他的播放器用的是 开源播放器 GSYVideoPlayer(<a href="https://github.com/CarGuo/GSYVideoPlayer" target="_blank" rel="noopener">https://github.com/CarGuo/GSYVideoPlayer</a>) </p>
</blockquote>
<p>主要看下这个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//我们额弹出窗就是从这里弹出的</span><br><span class="line">public void a(int i, Integer num) &#123;</span><br><span class="line">    if (num == null) &#123;</span><br><span class="line">    //后来猜测这个地方和清晰度切换的几个button的选中状态有关</span><br><span class="line">        PlayerActivity.this.A.b(i);</span><br><span class="line">        ((PlayerPresenter) PlayerActivity.this.b).a(i);</span><br><span class="line">    &#125; else if (d.b(PlayerActivity.this.r, com.mh.movie.core.mvp.ui.b.i)) &#123;</span><br><span class="line">    //我们当前没有权限就是走的这个方法。</span><br><span class="line">        PlayerActivity.this.a(((PlayerPresenter) PlayerActivity.this.b).c(9), num);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">    //从名字上来看这里是要求登录,这里不分析</span><br><span class="line">        com.jess.arms.c.a.a(QuickLoginActivity.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么我们尝试修改代码，让代码执行第一个if里面的东西，是不是就可以了？？？但是有个问题啊，我们现在并不清楚，如果有访问1080p的权限，那么，还会不会执行这个a方法？？？？？还是执行其他方法？？？？？我们来尝试一下。去买个1080p的权限，动态调试观察执行顺序。发现授权后，确实走了第一个if num==null的分支。但是现在我们并不清楚，这个分支里面代码的具体含义（后来猜测这个地方和清晰度切换的几个button的选中状态有关）。</p>
<p>然后抓包观察下请求视频的API；</p>
<p>没有兑换1080p权限之前<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;success&quot;: true,</span><br><span class="line">    &quot;code&quot;: null,</span><br><span class="line">    &quot;description&quot;: null,</span><br><span class="line">    &quot;imgAddr&quot;: null,</span><br><span class="line">    &quot;videoAddr&quot;: null,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;m3u8PlayUrl&quot;: &quot;http://v.tian1886.com/mahua/v/20181222/&quot;,</span><br><span class="line">        &quot;m3u8Format&quot;: &#123;</span><br><span class="line">            &quot;720P&quot;: &quot;0d2de4be5e245c8f1e4990e2169e9e88_4a59249d41144423bda0ebfb3a7d2ff5.m3u8?token=cz04ZDg4NzA5OGVhYTg4ZDdhMzBiMTUxNzEyYTg3NWU0NyZpPTE4MjUyMjk3JnA9NyZ0PTE1NDU5MDkxODYmbj1wQUpZeHFYSVJRJnI9MSZ2PTIuMy4wJmM9MiZlPTcyMA==&quot;,</span><br><span class="line">            &quot;360P&quot;: &quot;0d2de4be5e245c8f1e4990e2169e9e88_61d58f3b618b4986ac58693716f16262.m3u8?token=cz04ZDg4NzA5OGVhYTg4ZDdhMzBiMTUxNzEyYTg3NWU0NyZpPTE4MjUyMjk3JnA9NyZ0PTE1NDU5MDkxODYmbj1wQUpZeHFYSVJRJnI9MSZ2PTIuMy4wJmM9MiZlPTcyMA==&quot;,</span><br><span class="line">            &quot;480P&quot;: &quot;0d2de4be5e245c8f1e4990e2169e9e88_ac03cb71b620427a921084373841e3ac.m3u8?token=cz04ZDg4NzA5OGVhYTg4ZDdhMzBiMTUxNzEyYTg3NWU0NyZpPTE4MjUyMjk3JnA9NyZ0PTE1NDU5MDkxODYmbj1wQUpZeHFYSVJRJnI9MSZ2PTIuMy4wJmM9MiZlPTcyMA==&quot;,</span><br><span class="line">            &quot;free&quot;: &quot;0d2de4be5e245c8f1e4990e2169e9e88_5701b46b02214040a29fc1a4ad7ff44e.m3u8?token=cz04ZDg4NzA5OGVhYTg4ZDdhMzBiMTUxNzEyYTg3NWU0NyZpPTE4MjUyMjk3JnA9NyZ0PTE1NDU5MDkxODYmbj1wQUpZeHFYSVJRJnI9MSZ2PTIuMy4wJmM9MiZlPTcyMA==&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>兑换之后，点击播放视频：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;success&quot;: true,</span><br><span class="line">    &quot;code&quot;: null,</span><br><span class="line">    &quot;description&quot;: null,</span><br><span class="line">    &quot;imgAddr&quot;: null,</span><br><span class="line">    &quot;videoAddr&quot;: null,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;m3u8PlayUrl&quot;: &quot;http://v.tian1886.com/mahua/v/20181222/&quot;,</span><br><span class="line">        &quot;m3u8Format&quot;: &#123;</span><br><span class="line">            &quot;1080P&quot;: &quot;0d2de4be5e245c8f1e4990e2169e9e88_65e2e18cde0348f7bbd58845ebf4fc2b.m3u8?token=cz04ZDg4NzA5OGVhYTg4ZDdhMzBiMTUxNzEyYTg3NWU0NyZpPTE4MjUyMjk3JnA9NyZ0PTE1NDU5MDkxODYmbj1wQUpZeHFYSVJRJnI9MSZ2PTIuMy4wJmM9MiZlPTcyMA==&quot;,</span><br><span class="line">            &quot;720P&quot;: &quot;0d2de4be5e245c8f1e4990e2169e9e88_4a59249d41144423bda0ebfb3a7d2ff5.m3u8?token=cz04ZDg4NzA5OGVhYTg4ZDdhMzBiMTUxNzEyYTg3NWU0NyZpPTE4MjUyMjk3JnA9NyZ0PTE1NDU5MDkxODYmbj1wQUpZeHFYSVJRJnI9MSZ2PTIuMy4wJmM9MiZlPTcyMA==&quot;,</span><br><span class="line">            &quot;360P&quot;: &quot;0d2de4be5e245c8f1e4990e2169e9e88_61d58f3b618b4986ac58693716f16262.m3u8?token=cz04ZDg4NzA5OGVhYTg4ZDdhMzBiMTUxNzEyYTg3NWU0NyZpPTE4MjUyMjk3JnA9NyZ0PTE1NDU5MDkxODYmbj1wQUpZeHFYSVJRJnI9MSZ2PTIuMy4wJmM9MiZlPTcyMA==&quot;,</span><br><span class="line">            &quot;480P&quot;: &quot;0d2de4be5e245c8f1e4990e2169e9e88_ac03cb71b620427a921084373841e3ac.m3u8?token=cz04ZDg4NzA5OGVhYTg4ZDdhMzBiMTUxNzEyYTg3NWU0NyZpPTE4MjUyMjk3JnA9NyZ0PTE1NDU5MDkxODYmbj1wQUpZeHFYSVJRJnI9MSZ2PTIuMy4wJmM9MiZlPTcyMA==&quot;,</span><br><span class="line">            &quot;free&quot;: &quot;0d2de4be5e245c8f1e4990e2169e9e88_5701b46b02214040a29fc1a4ad7ff44e.m3u8?token=cz04ZDg4NzA5OGVhYTg4ZDdhMzBiMTUxNzEyYTg3NWU0NyZpPTE4MjUyMjk3JnA9NyZ0PTE1NDU5MDkxODYmbj1wQUpZeHFYSVJRJnI9MSZ2PTIuMy4wJmM9MiZlPTcyMA==&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原来这个1080p的播放地址在后端判断用户具有权限之后，就自动返回了。从接口的形式来看，即使界面能切换，没有1080p的接口返回数据也啥也做不了。那么像这种后端做判断直接返回数据的，我个人认为目前没有办法直接处理。只能通过一定的手段获取金币然后再进行兑换，而且我观察这个兑换接口也是后端计算的。</p>
<blockquote>
<p>所以结论是我处理不了，没有办法绕过无服务端的检查，直接请求1080p的播放地址值，但是从上面播放地址的规律上来看，应该是某个东西的md5值，如果能够破解加密算法那么有可能能解决。获取能够刷出无限金币</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://andx.site/2018/12/27/2018-12-27-麻花影视会员蓝关分析（方案不可行）/" data-id="cjqevhof2004fjl247vyrf0gr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/逆向/">逆向</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/麻花影视/">麻花影视</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2018-12-25-麻花影视去除热门视频强制分享的要求（完成）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/25/2018-12-25-麻花影视去除热门视频强制分享的要求（完成）/" class="article-date">
  <time datetime="2018-12-25T06:46:31.000Z" itemprop="datePublished">2018-12-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>►<a class="article-category-link" href="/categories/Android/逆向/">逆向</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/25/2018-12-25-麻花影视去除热门视频强制分享的要求（完成）/">2018-12-25-麻花影视去除热门视频强制分享的要求（完成）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>还是以《将夜》为例，每次播放的时候最新的一集必须分享朋友圈才能看。但是我不想分享。但是呢，其他的集不需要分享。猜测一下哈，这玩意肯定是后台给这一集打了个tag。</p>
<blockquote>
<p>为啥这里要做处理，我们对Android重打包之后，签名变化了，这个微信分享肯定是不成功的。所以不分享就看不了</p>
</blockquote>
<p>我们先不逆向代码。先来看下这最后一集返回的api和前面的普通视频的api有啥区别。</p>
<p>请求一个电视剧的所有信息的API叫做</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://api.hbzjmf.com/api/app/video/ver2/video/searchVideoInfoDetail_v2_2/2/7?videoId=0&amp;videoInfoId=7469&amp;from=0&amp;columnId=398&amp;time=1545466316484</span><br></pre></td></tr></table></figure>
<p>返回结果</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">	<span class="attr">"code"</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">"description"</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">"imgAddr"</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">"videoAddr"</span>: <span class="literal">null</span>,</span><br><span class="line">	<span class="attr">"data"</span>: &#123;</span><br><span class="line">		<span class="attr">"id"</span>: <span class="number">7469</span>,</span><br><span class="line">		<span class="attr">"type"</span>: <span class="number">2</span>,</span><br><span class="line">		<span class="attr">"title"</span>: <span class="string">"将夜"</span>,</span><br><span class="line">		<span class="attr">"director"</span>: <span class="string">"杨阳"</span>,</span><br><span class="line">		<span class="attr">"staring"</span>: <span class="string">"陈飞宇 / 宋伊人 / 胡军 / 郑少秋 / 孙祖君"</span>,</span><br><span class="line">		<span class="attr">"doubanScore"</span>: <span class="number">6.5</span>,</span><br><span class="line">		<span class="attr">"imdbScore"</span>: <span class="number">0.0</span>,</span><br><span class="line">		<span class="attr">"intro"</span>: <span class="string">"大唐边军宁缺带着小侍女桑桑来到帝都，调查十三年前灭门奇冤，一番努力考入至高学府书院，步入世间强者行列。荒人南迁，带来七卷天书的秘密，传说中的永夜将至，权倾天下的西陵神殿、神秘消逝的荒原魔宗、暗流涌动的燕唐边境、烂柯寺的血雨腥风，宁缺与桑桑卷入了昊天倾覆人间的劫难。世间动荡、英雄辈出，夫子、书院兄弟、书痴、道痴、花痴，隆庆皇子、知守观主、皇帝、将军、公主、各路修行强者、乃至普通的军人、少年，这注定是一个平凡人谱写的不平凡事迹，是世人对不公平命运吹响的战斗号角，是一个关于爱情、友情和信念的故事。 \r\n　　《将夜》终将至，花开彼岸天。"</span>,</span><br><span class="line">		<span class="attr">"classifyTypeList"</span>: [<span class="string">"国产剧"</span>, <span class="string">"古装"</span>, <span class="string">"奇幻"</span>, <span class="string">"剧情"</span>],</span><br><span class="line">		<span class="attr">"episodeState"</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">"episodeTotalCount"</span>: <span class="number">60</span>,</span><br><span class="line">		<span class="attr">"episodeUploadCount"</span>: <span class="number">54</span>,</span><br><span class="line">		<span class="attr">"playCount"</span>: <span class="number">24983851</span>,</span><br><span class="line">		<span class="attr">"coverTime"</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">"coverUrl"</span>: <span class="string">"http://img.piaosugo.com/v2/m_20181031_4769/m_20181031_4769.jpg"</span>,</span><br><span class="line">		<span class="attr">"coverHUrl"</span>: <span class="string">"http://img.piaosugo.com/v2/18/6040860da55c7e6435fe8e58262fedb6.jpg"</span>,</span><br><span class="line">		<span class="attr">"highCoverUrl"</span>: <span class="string">""</span>,</span><br><span class="line">		<span class="attr">"highCoverHUrl"</span>: <span class="string">""</span>,</span><br><span class="line">		<span class="attr">"createUser"</span>: <span class="string">"嫣阑世韵"</span>,</span><br><span class="line">		<span class="attr">"gmtCreateStr"</span>: <span class="string">"2018-10-31 22:13:05"</span>,</span><br><span class="line">		<span class="attr">"isLike"</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">"unlike"</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">"likeNum"</span>: <span class="number">13563</span>,</span><br><span class="line">		<span class="attr">"unlikeNum"</span>: <span class="number">3484</span>,</span><br><span class="line">		<span class="attr">"favorited"</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">"videoList"</span>: [&#123;</span><br><span class="line">			<span class="attr">"id"</span>: <span class="number">102894</span>,</span><br><span class="line">			<span class="attr">"isFavorite"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"isHighlight"</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">"title"</span>: <span class="string">"将夜"</span>,</span><br><span class="line">			<span class="attr">"sortNum"</span>: <span class="number">51</span>,</span><br><span class="line">			<span class="attr">"duration"</span>: <span class="number">2743</span>,</span><br><span class="line">			<span class="attr">"lastPlayTime"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"formatExtra"</span>: &#123;</span><br><span class="line">				<span class="attr">"1080P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">1546584</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"720P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">803916</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"360P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">146608</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"480P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">333168</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"free"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">70188</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">"statEndTimeP"</span>: &#123;</span><br><span class="line">				<span class="attr">"s"</span>: <span class="number">125</span>,</span><br><span class="line">				<span class="attr">"e"</span>: <span class="number">2595</span></span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">"period"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"tagDTO"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"playType"</span>: <span class="number">0</span></span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="attr">"id"</span>: <span class="number">102911</span>,</span><br><span class="line">			<span class="attr">"isFavorite"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"isHighlight"</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">"title"</span>: <span class="string">"将夜"</span>,</span><br><span class="line">			<span class="attr">"sortNum"</span>: <span class="number">52</span>,</span><br><span class="line">			<span class="attr">"duration"</span>: <span class="number">2690</span>,</span><br><span class="line">			<span class="attr">"lastPlayTime"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"formatExtra"</span>: &#123;</span><br><span class="line">				<span class="attr">"1080P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">1536724</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"720P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">802520</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"360P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">146868</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"480P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">333644</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"free"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">69536</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">"statEndTimeP"</span>: &#123;</span><br><span class="line">				<span class="attr">"s"</span>: <span class="number">125</span>,</span><br><span class="line">				<span class="attr">"e"</span>: <span class="number">2542</span></span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">"period"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"tagDTO"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"playType"</span>: <span class="number">0</span></span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="attr">"id"</span>: <span class="number">105180</span>,</span><br><span class="line">			<span class="attr">"isFavorite"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"isHighlight"</span>: <span class="number">1</span>,</span><br><span class="line">			<span class="attr">"title"</span>: <span class="string">"将夜"</span>,</span><br><span class="line">			<span class="attr">"sortNum"</span>: <span class="number">53</span>,</span><br><span class="line">			<span class="attr">"duration"</span>: <span class="number">2754</span>,</span><br><span class="line">			<span class="attr">"lastPlayTime"</span>: <span class="number">3</span>,</span><br><span class="line">			<span class="attr">"formatExtra"</span>: &#123;</span><br><span class="line">				<span class="attr">"1080P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">1564612</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"720P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">814564</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"360P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">148684</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"480P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">337916</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"free"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">70344</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">"statEndTimeP"</span>: &#123;&#125;,</span><br><span class="line">			<span class="attr">"period"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"tagDTO"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"playType"</span>: <span class="number">0</span></span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="attr">"id"</span>: <span class="number">105181</span>,</span><br><span class="line">			<span class="attr">"isFavorite"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"isHighlight"</span>: <span class="number">0</span>,</span><br><span class="line">			<span class="attr">"title"</span>: <span class="string">"将夜"</span>,</span><br><span class="line">			<span class="attr">"sortNum"</span>: <span class="number">54</span>,</span><br><span class="line">			<span class="attr">"duration"</span>: <span class="number">2750</span>,</span><br><span class="line">			<span class="attr">"lastPlayTime"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"formatExtra"</span>: &#123;</span><br><span class="line">				<span class="attr">"1080P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">1573728</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"720P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">818384</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"360P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">149432</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"480P"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">339816</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"free"</span>: &#123;</span><br><span class="line">					<span class="attr">"size"</span>: <span class="number">70560</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">"statEndTimeP"</span>: &#123;&#125;,</span><br><span class="line">			<span class="attr">"period"</span>: <span class="literal">null</span>,</span><br><span class="line">			<span class="attr">"tagDTO"</span>: &#123;</span><br><span class="line">				<span class="attr">"name"</span>: <span class="string">"热门"</span>,</span><br><span class="line">				<span class="attr">"backgroundColor"</span>: <span class="string">"#FFC000"</span>,</span><br><span class="line">				<span class="attr">"frontColor"</span>: <span class="string">"#FFFFFF"</span></span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">"playType"</span>: <span class="number">1</span></span><br><span class="line">		&#125;],</span><br><span class="line">		<span class="attr">"videoPageList"</span>: [&#123;</span><br><span class="line">			<span class="attr">"tabName"</span>: <span class="string">"1-50"</span>,</span><br><span class="line">			<span class="attr">"currentPage"</span>: <span class="number">1</span>,</span><br><span class="line">			<span class="attr">"pageSize"</span>: <span class="number">50</span>,</span><br><span class="line">			<span class="attr">"isShow"</span>: <span class="number">2</span></span><br><span class="line">		&#125;, &#123;</span><br><span class="line">			<span class="attr">"tabName"</span>: <span class="string">"51-100"</span>,</span><br><span class="line">			<span class="attr">"currentPage"</span>: <span class="number">2</span>,</span><br><span class="line">			<span class="attr">"pageSize"</span>: <span class="number">50</span>,</span><br><span class="line">			<span class="attr">"isShow"</span>: <span class="number">1</span></span><br><span class="line">		&#125;],</span><br><span class="line">		<span class="attr">"shareHtmlAddr"</span>: <span class="string">"http://m.imahua.com/v/8134663bbae2b6e4e5ed8217f1737da0"</span>,</span><br><span class="line">		<span class="attr">"years"</span>: <span class="number">2018</span>,</span><br><span class="line">		<span class="attr">"keywords"</span>: <span class="string">"剧情,古装,奇幻"</span>,</span><br><span class="line">		<span class="attr">"reviewNum"</span>: <span class="number">10696</span>,</span><br><span class="line">		<span class="attr">"tagSource"</span>: <span class="string">"网络"</span>,</span><br><span class="line">		<span class="attr">"videoInfoConfig"</span>: &#123;</span><br><span class="line">			<span class="attr">"videoCanDown"</span>: <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">"vipFlag"</span>: <span class="number">0</span>,</span><br><span class="line">		<span class="attr">"lastPeriod"</span>: <span class="string">"54"</span>,</span><br><span class="line">		<span class="attr">"tagDTO"</span>: &#123;</span><br><span class="line">			<span class="attr">"name"</span>: <span class="string">"火爆"</span>,</span><br><span class="line">			<span class="attr">"backgroundColor"</span>: <span class="string">"#FF0B0A"</span>,</span><br><span class="line">			<span class="attr">"frontColor"</span>: <span class="string">"#FFFFFF"</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>//仔细观察哈，这个 <code>videoList</code> 是电视剧剧集列表，而当前最新的一集是54集，看这个54和别的不一样的地方</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;tagDTO&quot;: &#123;</span><br><span class="line">			&quot;name&quot;: &quot;火爆&quot;,</span><br><span class="line">			&quot;backgroundColor&quot;: &quot;#FF0B0A&quot;,</span><br><span class="line">			&quot;frontColor&quot;: &quot;#FFFFFF&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>哦哦，原来api多了这么个字段，我们来验证一下，这个字段去掉是不是就能看了。还是借助于Charles。先把上面的返回结果复制一份，然后把这个tagDTO的字段改成null，然后保存到电脑，命名为demo.json，然后重定向上面的api请求为本地的json文件。</p>
<p>在Charles的右侧抓包的列表里面对应的url上面右键–&gt;Map Local….</p>
<p><img src="https://note.youdao.com/yws/public/resource/2aaa20465ab7ce4c8e624e2e5969be9b/xmlnote/BBB8A60B51814571B8FCA0A6F3B4B086/2031" alt=""></p>
<p>哈哈哈，掩耳盗铃，自欺欺人，虽然这样隐藏了火爆的tag，但是依然不能播放，Toast提示说获取对应分辨率出错。也就是说获取视频真实地址的时候出错了。</p>
<p>也就是说，在分享成功的时候肯定是做了什么操作，（回向服务器发送数据等），导致了能够观看视频了。我们来抓包验证一下。好像没啥有用的地方。那就分析一下界面吧，</p>
<p>借助monitor通过界面分析进入逻辑代码：</p>
<p><img src="https://note.youdao.com/yws/public/resource/2aaa20465ab7ce4c8e624e2e5969be9b/xmlnote/F446C3BA1DAF4882B5CD11E2B9B7A3D0/2071" alt="通过Android Device Monitor dump 出当前view，查看按钮的id"></p>
<p>能够看到当前按钮的id 为 <code>com.amahua.ompimdrt:id/ll_video_player_watch_mhb</code>,我们的目的是为了获取这个按钮的点击事件，所以jadx全局搜索 <code>ll_video_player_watch_mhb</code>,然后得到 <code>llVideoPlayerWatchMhb</code>,然后全局搜索 llVideoPlayerWatchMhb得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//com.mh.movie.core.mvp.ui.activity.player.PlayerActivity</span><br><span class="line">  private void C() &#123;</span><br><span class="line">      this.mhVideoPlayer.ivPlayerVideoScreen.setOnClickListener(this.F);</span><br><span class="line">      this.mhVideoPlayer.llVideoPlayerTryWatchOne.setOnClickListener(this.F);</span><br><span class="line">      this.mhVideoPlayer.llVideoPlayerTryWatch.setOnClickListener(this.F);</span><br><span class="line">      //点击事件是从这里注册的，接下来看这个this.F</span><br><span class="line">      this.mhVideoPlayer.llVideoPlayerWatchMhb.setOnClickListener(this.F);</span><br><span class="line">      this.mhVideoPlayer.setiPlayStateListener(this.G);</span><br><span class="line">      this.mhVideoPlayer.setOpreteCallBack(this.J);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>从jdax代码跟踪来看，这个F成员变量是个 <code>com.mh.movie.core.mvp.ui.activity.player.k</code> 类型的对象，也就是OnClickListener的实现类，但是这个类最终还是调用了PlayerActivity的c(View) 方法,这里动态调试一下，如果不会动态调试Smali的话看这里: <a href="https://www.jianshu.com/p/1a28e6439c6a" target="_blank" rel="noopener">AndroidStudio无源码动态调试apk</a></p>
<p>很可惜，可能jadx反编译有问题吧，从jadx里面找不到这个c方法的签名。但是jeb可以反编译得到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">final void c(View arg4) &#123;</span><br><span class="line">    this.Q = d.b(((Context)this), com.mh.movie.core.mvp.ui.b.i);</span><br><span class="line">    int v0 = arg4.getId();</span><br><span class="line">    if(v0 != id.iv_player_video_screen) &#123;</span><br><span class="line">        String v1 = null;</span><br><span class="line">        int v2 = 8;</span><br><span class="line">        if(v0 == id.ll_video_player_try_watch_one) &#123;</span><br><span class="line">            this.mhVideoPlayer.rlVideoPlayerDetailOne.setVisibility(v2);</span><br><span class="line">            this.b.a(v1);</span><br><span class="line">        &#125;</span><br><span class="line">        else if(v0 == id.ll_video_player_try_watch) &#123;</span><br><span class="line">            this.mhVideoPlayer.rlVideoPlayerDetail.setVisibility(v2);</span><br><span class="line">            this.b.a(v1);</span><br><span class="line">        &#125;</span><br><span class="line">        else if(v0 == id.ll_video_player_watch_mhb) &#123;</span><br><span class="line">        //走了这行代码</span><br><span class="line">            this.q();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else if(!this.Q) &#123;</span><br><span class="line">        com.jess.arms.c.a.a(QuickLoginActivity.class);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        TableCommodity v0_1 = this.b.c(1);</span><br><span class="line">        if(v0_1.hasFlag == 1) &#123;</span><br><span class="line">            this.b.a(((Activity)this));</span><br><span class="line">        &#125;</span><br><span class="line">        else if(!NetworkUtils.isAvailable(arg4.getContext())) &#123;</span><br><span class="line">            T.showShort(arg4.getContext(), &quot;当前无网络连接，请连上网络后再试&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            this.a(v0_1);</span><br><span class="line">            this.mhVideoPlayer.hideAllWidget();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public void q() &#123;</span><br><span class="line">    ((PlayerPresenter) this.b).c(true);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先不往下分析了，没啥意思，解下来肯定一大串网络请求和控制之类的。仔细思考下这个流程：只有我分享成功，那么后台就会知道？？那么就能看视频了。那么我们去看下微信分享成功之后做了什么操作。</p>
<p>com.amahua.ompimdrt.wxapi.WXEntryActivity</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//在微信的response 里面分享结果发了一个广播</span><br><span class="line"> public void onResp(BaseResp baseResp) &#123;</span><br><span class="line">     Intent intent = new Intent(&quot;action_wx_share_response&quot;);</span><br><span class="line">     intent.putExtra(&quot;result&quot;, new Response(baseResp));</span><br><span class="line">     sendBroadcast(intent);</span><br><span class="line">     finish();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>全局搜索 action_wx_share_response</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//com.mh.movie.core.c.e</span><br><span class="line">    public e a() &#123;</span><br><span class="line">        this.b.registerApp(b.C.getWXKey());</span><br><span class="line">        this.d = new a(this, null);</span><br><span class="line">        //去看这个this.d 这个receiver</span><br><span class="line">        this.a.registerReceiver(this.d, new IntentFilter(&quot;action_wx_share_response&quot;));</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">//动态调试一下观察我们重打包后的走了哪里</span><br><span class="line">//因为我们重打包的app的签名已经变了，微信分享肯定不能成功</span><br><span class="line">public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">     try &#123;</span><br><span class="line">         Response response = (Response) intent.getParcelableExtra(&quot;result&quot;);</span><br><span class="line">         if (e.this.c != null) &#123;</span><br><span class="line">             if (response == null) &#123;</span><br><span class="line">                 e.this.c.h();</span><br><span class="line">             &#125; else if (response.errCode == 0) &#123;</span><br><span class="line">                 e.this.c.h();</span><br><span class="line">             &#125; else if (response.errCode == -2) &#123;</span><br><span class="line">                 e.this.c.k();</span><br><span class="line">             &#125; else &#123;</span><br><span class="line">                 String str;</span><br><span class="line">                 switch (response.errCode) &#123;</span><br><span class="line">                     case -5:</span><br><span class="line">                         str = &quot;不支持错误&quot;;</span><br><span class="line">                         break;</span><br><span class="line">                     case -4:</span><br><span class="line">                         str = &quot;发送被拒绝&quot;;</span><br><span class="line">                         break;</span><br><span class="line">                     default:</span><br><span class="line">                         str = &quot;发送返回&quot;;</span><br><span class="line">                         break;</span><br><span class="line">                 &#125;</span><br><span class="line">                 //把这个调用c(str) 的方法，我们强制调用上面的，e.this.c.h();方法。</span><br><span class="line">                 e.this.c.c(str);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125; catch (Throwable e) &#123;</span><br><span class="line">         com.google.a.a.a.a.a.a.a(e);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>断点打在<code>.class Lcom/mh/movie/core/c/e$a;</code>这个类里面的onReceive 方法上。我么看下这个this.c 是个啥，并且他的h() k() 又是啥，如果我们强制调用this.c.h()行不行，修改代码重新打包测试一下，发现果然可以。</p>
<blockquote>
<p>其实到这里就差不多算是已经分析完了，而且分享功能也基本算是破解了，只不过要点一下才可以，如果这一下都不想点，那么可以把代码copy到上面那个 <code>观看完整版</code>的按钮的点击事件里面去。</p>
</blockquote>
<p>上面的分析仅仅是能用了，我们是从事件传递角度，对事件进行了改写，把错误的结果重定向到了正确的操作上面，但是我们现在依然不知道是什么原理导致不分享不能观看，我们继续分析一下哈，找到这个this.c 初始化的地方，如果竟然分析的话可以通过jadx的find usage的功能，如果动态分析话，通过as的Smali插件观察调用堆栈，就能找到初始化的地方在 PlayerActivity 里面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">public void r() &#123;</span><br><span class="line">    if (d.b(this, com.mh.movie.core.mvp.ui.b.i)) &#123;</span><br><span class="line">        if (this.ag == null) &#123;</span><br><span class="line">        //这个new 出来的a方法就是上面的 this.c 的实体类</span><br><span class="line">            this.ag = new ShareToFriendDialog(this, new a() &#123;</span><br><span class="line">                public void h() &#123;</span><br><span class="line">                //可疑代码 1</span><br><span class="line">                    com.mh.movie.core.c.b.a().e();</span><br><span class="line">                    PlayerActivity.this.mhVideoPlayer.rlVideoPlayerDetail.setVisibility(8);</span><br><span class="line">                    PlayerActivity.this.mhVideoPlayer.rlVideoPlayerDetailOne.setVisibility(8);</span><br><span class="line">                    //可疑代码 2 ，这个方法我们是不是应该很熟悉，我们在分析麻花影视视频播放地址那篇里面看过这个，就是主要用来播放视频的</span><br><span class="line">                    ((PlayerPresenter) PlayerActivity.this.b).a(1, &quot;请欣赏完整版&quot;, null);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                public void k() &#123;</span><br><span class="line">                    com.mh.movie.core.c.b.a().b(&quot;3&quot;);</span><br><span class="line">                    T.showShort(PlayerActivity.this.r, (CharSequence) &quot;取消分享&quot;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                public void c(String str) &#123;</span><br><span class="line">                    com.mh.movie.core.c.b.a().b(&quot;1&quot;);</span><br><span class="line">                    T.showShort(PlayerActivity.this.r, (CharSequence) str);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        //事件是在这里注册的</span><br><span class="line">        com.mh.movie.core.c.b.a().initWxShare(this.ag.b);</span><br><span class="line">        this.ag.a(d(((PlayerPresenter) this.b).f()));</span><br><span class="line">        this.ag.show();</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    com.jess.arms.c.a.a(QuickLoginActivity.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们先来看可以代码2，这个地方的代码是根据视频id请求视频播放地址的api，这个我们在上篇文章 <code>分析麻花影视视频播放地址</code> 里面分析过了。这里应该没有什么特殊操作</p>
<p>那我们来验证下，先把上面 可疑代码1里面的东西注释掉。看看分享之后还能不能观看视频。如果不能说明这行很关键。找到 <code>.class Lcom/mh/movie/core/mvp/ui/activity/player/PlayerActivity$22;</code> 类，因为这里 ShareToFriendDialog 是个匿名对象。所以。。。。</p>
<p>好像，去掉后并没有啥作用。。。。。那就先分析到这里吧，不想分析了。。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://andx.site/2018/12/25/2018-12-25-麻花影视去除热门视频强制分享的要求（完成）/" data-id="cjqevhiq2004ajl24jq8tzi4d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/逆向/">逆向</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/麻花影视/">麻花影视</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2018-12-18-麻花影视模拟发送请求（完成）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/18/2018-12-18-麻花影视模拟发送请求（完成）/" class="article-date">
  <time datetime="2018-12-18T06:46:31.000Z" itemprop="datePublished">2018-12-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>►<a class="article-category-link" href="/categories/Android/逆向/">逆向</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/18/2018-12-18-麻花影视模拟发送请求（完成）/">2018-12-18-麻花影视模拟发送请求（完成）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>目的：能够模拟发送任意麻花影视的api请求</p>
<p>我们现在不能随便发请求的原因：请求头里面有签名值，这个签名值是计算出来的，每次都不一样，我们找到计算过程。</p>
<p>一般来说这种签名具有整个app的通用性，所以我们选择一个好分析的api进行分析，然后再在其他的api 验证一下就行了。</p>
<p>一般来说页面越简单，api的参数构造啥的越容易分析。那，我们分析登陆页面和任务页面（主页面第三个tab）吧。</p>
<h3 id="先来看登录界面"><a href="#先来看登录界面" class="headerlink" title="先来看登录界面"></a>先来看登录界面</h3><p>前提是我已经注册账号了。</p>
<p>登陆界面<code>com.amahua.ompimdrt/com.mh.movie.core.mvp.ui.activity.user.QuickLoginActivity</code></p>
<p>布局文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public int a(@Nullable Bundle bundle) &#123;</span><br><span class="line">    return R.layout.quick_login_layout;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据上面布局文件，可以发现登陆按钮的id为 tv_login：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView</span><br><span class="line">    android:id=&quot;@id/tv_login&quot;</span><br><span class="line">    android:layout_width=&quot;fill_parent&quot;</span><br><span class="line">    android:layout_height=&quot;44.0dip&quot;</span><br><span class="line">    android:layout_marginLeft=&quot;28.0dip&quot;</span><br><span class="line">    android:layout_marginTop=&quot;48.0dip&quot;</span><br><span class="line">    android:layout_marginRight=&quot;28.0dip&quot;</span><br><span class="line">    android:background=&quot;@drawable/login_btn_red&quot;</span><br><span class="line">    android:enabled=&quot;true&quot;</span><br><span class="line">    android:gravity=&quot;center&quot;</span><br><span class="line">    android:text=&quot;登 录&quot;</span><br><span class="line">    android:textColor=&quot;@color/white&quot;</span><br><span class="line">    android:textSize=&quot;16.0sp&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>然后找到这个按钮的点击事件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@OnClick(&#123;2131493139, 2131493137, 2131493822, 2131493823, 2131493136, 2131493821, 2131493877, 2131493949, 2131493851&#125;)</span><br><span class="line">    public void onClick(View view) &#123;</span><br><span class="line">        int id = view.getId();</span><br><span class="line">        //省略无关代码</span><br><span class="line">            else if (id == R.id.tv_login) &#123;</span><br><span class="line">                if (this.i == a.QUICK_LOGIN) &#123;</span><br><span class="line">                    k();//一般来说快速登陆就是验证码登陆</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    l();//我们用密码登陆</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; </span><br><span class="line">        //省略无关代码</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public void l() &#123;</span><br><span class="line">    if (this.etPhoneNum.getText().toString().equals(&quot;&quot;)) &#123;</span><br><span class="line">        T.showShort((Context) this, (CharSequence) &quot;请输入手机号码&quot;);</span><br><span class="line">    &#125; else if (this.etPsw.getText().toString().equals(&quot;&quot;)) &#123;</span><br><span class="line">        T.showShort((Context) this, (CharSequence) &quot;请输入密码&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        AccountCommonRequest accountCommonRequest = new AccountCommonRequest();</span><br><span class="line">        accountCommonRequest.setAccount(this.etPhoneNum.getText().toString());</span><br><span class="line">        accountCommonRequest.setPassword(this.etPsw.getText().toString());</span><br><span class="line">        StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line">        stringBuilder.append(&quot;+&quot;);</span><br><span class="line">        stringBuilder.append(this.d);    //int d = 86;</span><br><span class="line">        accountCommonRequest.setCountry(stringBuilder.toString());</span><br><span class="line">        //调用 Presenter  发送网络请求</span><br><span class="line">        ((QuickLoginPresenter) this.b).b(accountCommonRequest, true);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>抓包：</p>
<p>请求<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET /api/app/member/ver2/user/accountSiginIn/2/7?account=19*******04&amp;password=********&amp;time=1545295189878 HTTP/1.1</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Accept: application/json</span><br><span class="line">accessToken: c96dfa9be9f6d78afb9ec58df3d372f4dc34742e4b6b2fd68513e4194b704f23</span><br><span class="line">X-Client-NonceStr: 6LBMGNuKbB</span><br><span class="line">X-Client-IP: 127.0.0.1</span><br><span class="line">X-Client-TimeStamp: 1545295189878</span><br><span class="line">X-Client-Version: 2.3.0</span><br><span class="line">X-Client-Sign: 3e0df8599d0cfc03ca651bec69a94203587645e53e2004c80f815db37465aaab</span><br><span class="line">X-Client-Token: </span><br><span class="line">X-Auth-Token: mb_token:24115547:b4043b30a7f03daa3d5a9f2a468bbdef</span><br><span class="line">Host: api.hbzjmf.com</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line">User-Agent: okhttp/3.11.0</span><br></pre></td></tr></table></figure></p>
<p>响应：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: Tengine</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line">Content-Length: 1504</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Date: Thu, 20 Dec 2018 08:39:50 GMT</span><br><span class="line">X-Server-TimeStamp: 1545295190</span><br><span class="line">accessToken: c96dfa9be9f6d78afb9ec58df3d372f4dc34742e4b6b2fd68513e4194b704f23</span><br><span class="line">Ali-Swift-Global-Savetime: 1545295190</span><br><span class="line">Via: cache16.l2cm9[137,200-0,M], cache23.l2cm9[138,0], cache17.cn1452[160,200-0,M], cache16.cn1452[160,0]</span><br><span class="line">X-Cache: MISS TCP_MISS dirn:-2:-2</span><br><span class="line">X-Swift-SaveTime: Thu, 20 Dec 2018 08:39:50 GMT</span><br><span class="line">X-Swift-CacheTime: 0</span><br><span class="line">Timing-Allow-Origin: *</span><br><span class="line">EagleId: 7488872415452951902903171e</span><br><span class="line"></span><br><span class="line">6cab6feb4e159bdbcb652ffd544a32db308bb2bd2b00f17c9a3d523c69159a0ed7589f602c30130ad2f0213226281767123cac47ca86c8f24511cec75a89b19227ecbae6b5f4ce564561098f2b12d2d4f5a6a162edfbd2b0e8e8ad8628013149e17ead26f496ae37e9aa2b594cc4ce67716bceed1462b9d10904349d1f50c5c602ba41ea2eee25e82afaf2de9b674ecf0076a3a27a2c682175b290f890ce5f187daead0792c5f700b72566d8cc6c797565107de8db83f6f4d16abd6d3cbde6477dd7826654d7a69bb0f571dee76411e68774bfc5f8a517905f0e3d39dd8eab2d945b49d326a5f578b2ecef4306d878d2594be7c7b51ff57c7b22da37b43d25ba2fa0efe845113ab6d8c218e75fe9fd6dd774463daba684cf9155724c858c8b86d24aaea9d4d5b01ab62013fe03a9081e9809e928232864caf002b3176ebaa5340e097ecd85186189b55d4890f6e3d960ee9ce04c9add2d3fb0a33996532b308064233a814e17d175b1aa3a86b3a8abbd774182aef02ea16b7d88d076de50565bf29b226c2848ce4a044b9405e0c0d814c3c6d9bb8b994b4e1dc5bf19937ac8827a55ef1d3de8b05b78caa9fb75e738e86ada4b976a129a4d77ff70680a6043fefdd8e953590fe2a404938a91f8dcde8a102df61f0501dfd1853f05477c433267cdec15df451c2890fd6b423f2cef8d85b96f65aef3f7321858fd9c35af33238e4f3314e95906306deac0af22c612045951e7be983aa5c0b9ecc547e0b9bf74d9a0e5b516f0aba78310407b744978453558c65d77eab6685864e8ddb7b183beb6bf7f2ef3c35aed1bddb3cf1884c0289f247468655eeacb1cfc5a6c65d116796d7f32bb1f731a8d07a9126fc8de2481c5542dfc32fddb61ce2e629d1b070e54708aa682388ac404df4548257fd8bdef25941a61d6812b1eef79173d2583c28501d4edad09ac6e69c9f8674c54e11c830857e6e82fd53af1e29e9d59c61d88b869df7547014e29711ebbb5beef3fd3934e292d6d7e94ed023f3f034e9e02e4637a43218f4ac51baf36a95a83**********</span><br></pre></td></tr></table></figure>
<p>因为上面是抓的真是数据，<strong>请求参数</strong>和<strong>返回结果</strong>的关键信息用 <code>*******</code> 代替了,并不影响阅读，返回的数据是加密的用我们上一篇的工具进行解密,得到如下的json：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"code"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"description"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"imgAddr"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"videoAddr"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"data"</span>: &#123;</span><br><span class="line">        <span class="attr">"userDetail"</span>: &#123;</span><br><span class="line">            <span class="attr">"userId"</span>: *****,</span><br><span class="line">            <span class="attr">"token"</span>: <span class="string">"mb_token:****:************************************"</span>,</span><br><span class="line">            <span class="attr">"userType"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"login"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"countryCode"</span>: <span class="string">"+86"</span>,</span><br><span class="line">            <span class="attr">"cellphone"</span>: <span class="string">"************"</span>,</span><br><span class="line">            <span class="attr">"invitationCode"</span>: <span class="string">"m0ln5"</span>,</span><br><span class="line">            <span class="attr">"score"</span>: <span class="number">125</span>,</span><br><span class="line">            <span class="attr">"level"</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="attr">"levelScore"</span>: <span class="number">200</span>,</span><br><span class="line">            <span class="attr">"nickName"</span>: <span class="string">"m0ln5"</span>,</span><br><span class="line">            <span class="attr">"gender"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"avatarUrl"</span>: <span class="string">"http://img.piaosugo.com/61/66b5ab23f7514d955270d680acd5a47b.png"</span>,</span><br><span class="line">            <span class="attr">"email"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"packageId"</span>: <span class="number">7</span>,</span><br><span class="line">            <span class="attr">"begVideoNum"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"barrageNum"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"cancelAdNum"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"canCacheNum"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"restCacheNum"</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="attr">"invitation"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"money"</span>: <span class="number">40</span>,</span><br><span class="line">            <span class="attr">"authIdList"</span>: [</span><br><span class="line">                <span class="number">3</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"loginToken"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"sign"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"proMark"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"findIsOpen"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"playList"</span>: [],</span><br><span class="line">        <span class="attr">"playNum"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"favList"</span>: [],</span><br><span class="line">        <span class="attr">"favoriteNum"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"day"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"money"</span>: <span class="number">40</span>,</span><br><span class="line">        <span class="attr">"isNewRegist"</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>这个登录成功返回得到的token 就是 将来请求头里面的 X-Auth-Token 的值。</strong>,而在登录之前，会访问 服务获取一个临时的 token </p>
</blockquote>
<p>现在要分析的点是在请求头里面出现了几个重要参数，这些参数每次请求都是变化的，我们现在要找到在程序的什么地方设置了请求头。一般来说这玩意会在Okhttp的Interceptor里面处理。先来看下这几个比较特殊的参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">accessToken: c96dfa9be9f6d78afb9ec58df3d372f4dc34742e4b6b2fd68513e4194b704f23</span><br><span class="line">X-Client-NonceStr: 6LBMGNuKbB</span><br><span class="line">X-Client-Sign: 3e0df8599d0cfc03ca651bec69a94203587645e53e2004c80f815db37465aaab</span><br><span class="line">X-Client-Token: </span><br><span class="line">X-Auth-Token: mb_token:24115547:b4043b30a7f03daa3d5a9f2a468bbdef</span><br></pre></td></tr></table></figure>
<p>偷个懒，不去逐步分析了。全局搜索一下这几个关键字。发现都指向了同一个文件。<code>com.mh.movie.core.app.i</code> 仔细看下这个类，不是Interceptor的变种而已，这是因为他用了框架的额原因，这个类是框架的回调而已。哈哈哈真的有缘，还记得不我们遇到过这个类，在解除他的抓包限制的时候，其中的代理检测方法就在这个类里面。</p>
<p>这个类里面一共就三个方法，一个是拦截处理修改请求的，一个拦截处理相应，一个是私有方法，检测是否使用了代理。我们这次来看是如何修改请求头的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">return chain.request().newBuilder().url(stringBuilder)</span><br><span class="line">.header(HttpHeaders.CONTENT_TYPE, &quot;application/json&quot;)</span><br><span class="line">.header(HttpHeaders.ACCEPT, &quot;application/json&quot;)</span><br><span class="line">.header(&quot;accessToken&quot;, encryptToHex)</span><br><span class="line">.header(&quot;X-Client-NonceStr&quot;, createHeaderInfo.getXClientNonceStr())</span><br><span class="line">.header(&quot;X-Client-IP&quot;, createHeaderInfo.getXClientIP())</span><br><span class="line">.header(&quot;X-Client-TimeStamp&quot;, createHeaderInfo.getXClientTimeStamp())</span><br><span class="line">.header(&quot;X-Client-Version&quot;, createHeaderInfo.getXClientVersion())</span><br><span class="line">.header(&quot;X-Client-Sign&quot;, createHeaderInfo.getXClientSign())</span><br><span class="line">.header(&quot;X-Client-Token&quot;, com.mh.movie.core.mvp.ui.b.a().getLoginToken() != null ? com.mh.movie.core.mvp.ui.b.a().getLoginToken() : &quot;&quot;)</span><br><span class="line">.header(&quot;X-Auth-Token&quot;, createHeaderInfo.getXAuthToken()).build();</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">String stringBuilder;</span><br><span class="line"><span class="comment">//在下面单独分析getEncryptPackageId，很简单就是个随机算法</span></span><br><span class="line">String encryptToHex = AesUtil.encryptToHex(com.mh.movie.core.mvp.ui.b.C.getEncryptPackageId(), AesUtil.getKey(<span class="keyword">true</span>));</span><br><span class="line"><span class="comment">//断点调试一下这个path的样子。</span></span><br><span class="line"><span class="comment">//大概这么个样子：/api/app/member/ver2/user/userTaskCenter/</span></span><br><span class="line">String path = request.url().uri().getPath();</span><br><span class="line">StringBuilder stringBuilder2 = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">stringBuilder2.append(path);</span><br><span class="line">stringBuilder2.append(com.mh.movie.core.mvp.ui.b.C.getTerminal());<span class="comment">//isEmulator() ? "5" : "2";模拟器检查</span></span><br><span class="line">stringBuilder2.append(<span class="string">"/"</span>);</span><br><span class="line">stringBuilder2.append(RHelp.getPackageId());<span class="comment">//这里目前为 "7"</span></span><br><span class="line">path = stringBuilder2.toString();</span><br><span class="line"><span class="comment">//上面基本参数都已经构造好了，就看这个createHeaderInfo 方法</span></span><br><span class="line"><span class="comment">//这个方法也比较简单，基本上所有的操作都在工具类里面</span></span><br><span class="line"><span class="comment">//只有一个值的构建是动态的 headerInfo.setXAuthToken(b.E); 这个值就是在登陆的时候返回的token</span></span><br><span class="line"><span class="comment">//还有两个设置我们用不到  headerInfo.setXAuthTimeStamp(b.F); 和 headerInfo.setXAuthSign(b.G); </span></span><br><span class="line"><span class="comment">//我直接给注释掉了</span></span><br><span class="line">HeaderInfo createHeaderInfo=com.mh.movie.core.mvp.ui.b.C.createHeaderInfo(path);</span><br></pre></td></tr></table></figure>
<p>经过上面的分析，基本上参数都已经齐了，写个demo验证一下就好了。目前来说发现的唯一一个不用 X-Auth-Token 的api、</p>
<p>在app第一安装启动的时候，会先访问一次这个api,这个api的返回数据里面包含临时的auth-token:</p>
<p>请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET /api/app/member/ver2/user/login/2/7?uuid=862629030227329&amp;model=EVA-AL10Android%207.0&amp;time=1545305790886 HTTP/1.1</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Accept: application/json</span><br><span class="line">accessToken: 8f9be3c59d2d1187cb2e19136b4a1ac3ddbecd2f4373f449e52c00dbcb068375</span><br><span class="line">X-Client-NonceStr: VOadeTfPfI</span><br><span class="line">X-Client-IP: 127.0.0.1</span><br><span class="line">X-Client-TimeStamp: 1545305790886</span><br><span class="line">X-Client-Version: 2.3.0</span><br><span class="line">X-Client-Sign: dd6b6b2115d4f1ce1e4df42e6db332f418cef2100c95923a0dd5c24c9b6c2700</span><br><span class="line">X-Client-Token: </span><br><span class="line">X-Auth-Token: </span><br><span class="line">Host: api.hbzjmf.com</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line">User-Agent: okhttp/3.11.0</span><br></pre></td></tr></table></figure>
<p>响应：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: Tengine</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Date: Thu, 20 Dec 2018 11:36:31 GMT</span><br><span class="line">X-Server-TimeStamp: 1545305791</span><br><span class="line">accessToken: 8f9be3c59d2d1187cb2e19136b4a1ac3ddbecd2f4373f449e52c00dbcb068375</span><br><span class="line">Ali-Swift-Global-Savetime: 1545305791</span><br><span class="line">Via: cache24.l2cm9[71,200-0,M], cache43.l2cm9[72,0], kunlun8.cn206[87,200-0,M], kunlun5.cn206[88,0]</span><br><span class="line">X-Cache: MISS TCP_MISS dirn:-2:-2</span><br><span class="line">X-Swift-SaveTime: Thu, 20 Dec 2018 11:36:31 GMT</span><br><span class="line">X-Swift-CacheTime: 0</span><br><span class="line">Timing-Allow-Origin: *</span><br><span class="line">EagleId: 9903e79915453057913148035e</span><br><span class="line"></span><br><span class="line">6cab6feb4e159bdbcb652ffd544a32db308bb2bd2b00f17c9a3d523c69159a0ed7589f602c30130ad2f0213226281767123cac47ca86c8f24511cec75a89b19227ecbae6b5f4ce564561098f2b12d2d4add2b22ff23f4e85162004c3aa6663e409b0c9e827d34b8b6b5fc0f4b703363cbc2138ff88efeb635fd49d38c3f88bfa2bb8de4ad7fe136a6170ae9b17ab25ce251184ede21867a5d3748936effd78f5e9f8a6a5e99cfbee2b021b971d7c9048c499423a50c50c2d1d61a7cffcc166739eb34cfca0ac3fe013a89a6653deb60b3d303ef828de3940b0ecebbe6963ecfeba0c73499af2c4e9f7bf4391cce764479512b1fd45d4b96afce6101c5b9420a04d058bd321ed97626a18c604a88b8d5a4ead266f88832614bc7cb41230b7d5331fca4473eb2f4ffbb52c9b4b759045d990c3999addf79d39032dabbb3d0cc6bbcb029cfbc1faca2406b8cf557f3060bca3ffbefa6f32a92e89264189e036727827e06b72651612c935de32b8b6f17162d434b3889dcc1fedab4d8f1e7be3474006d3ba2746c125e8f86ab695f49e134fa75084f65abe5c7da03c9e20777214a279ae98b1ee1e3f6d3f2810fbc6ad63fc1ef8e283202ab5a8781e788ab82b8b66a89b4a520c49998e46c223cc6c8103c39606f810af1fcf9e25de3f6920f0cdb833d127c710b32515f4d369ee0ae4c41d975f587df97a0fe1a083402658f7d1af450be793244c8a039ad5c8dd1747992076986ce69180c00993574bcf39ff41d8de55c300cd98c02fe05b213845628791a25b2c6d4ef80efdca7b828acd3293e9f0a3e32612a1440856996ea84f36410f266537119f8035a80af644dfb1891cb58bc21c9d73e268fc4931f75b95c688fe32f2b9b1b4f3561aeb3fd7b9298e48775ad8a5acf0e017d58868449333da9d523ee7d89c71650ca10479943ddbc0934ee0eb1e2dfc9d62bb5fc6be2abb101d2512a4742298c63bd6da3ffbf28df663fca5a5f8503320607e239db8dc0f09c012850e153807a2bb9c37709c8bf6b0aa107d497a3a1a43e59b8bc3b03def515f7bb88db94dd97361ef9fd3809bc497950fd8fd6128d9edd68fd81af27db90617f66134bc8b17c9ef66d06396738163dd6ab4fc4bc280989bfcf81c40f9b7f7f7e443dc59d1b04340cd46e998407d072b800ab89fab7856ff86e7abb9f4e236e89d5b9934eb8d274c3d3a1e475f823b902a530bd7ddc4b3b0c7f3728fce8267e3ae3c6db1134dd6e18cc0f06d7672ad13b28608156bb8f3ff1a78133105f925168a89b944274a4846e08da0e2f8214aea1c32d2a7f5ba70567e4fe901a152da3573d16df82966cf4b5c18212cd09a5de75c50dc1ab48f4294e553cc4f1b7d58332cd64ecfd3e932d814840d4facd763179472a6fb22a4ef19d8948d28daf7df428c4c9f3974075bb606e7448e6c763def824671072c2bceefbe8530bb8eb19cebe2affb5a9c3c2cd5673e86562b7b2905d907c4d4b2643a6faeac2780a28be36a955524f0f5bac0599c9f9bb080f304b6751a9eaa204fa3cef5d1be7f0df5212c50f268314b4bb2e3969b9d8d1c745a9147426167cc568c90fcdd19b61cf03135f323e152054d68861c4873412256e2c437aa13807051cfc7237afab51f06c0d171a378c7e56cecd92352fccf34c8f53e40637549d6c3862302e109eea22abc7b0f1a4eca0887b8b413ea0686961b74da94ff5c0eec0b584880bbb26b888ab5d9723f51177b7220f65e6ecfa167e101bf4ee12310b94e76f033b36fe7464e3050f7a5aa7700ab354b7ea9337fe413ecc7a195c981832bda58db63bf9ae7891fbccc9db9f479da2401a3035e525eb742c613e1dd6fcc3648a9b9f00503599e90c554acf40a3130f589d6360a860b865da064fbfae0d507a998a96703b04d7a07804082d37c829f616f9cb135be55df8d0a7fec97949e52cebb8ae9148240ea8aab63d2fbca015e7aed8fba2371a1b6df3351e80171e1a23121dd681787dcad6c1fe814982bdb070d30ce4b2cc81d23d365b54b8953d8a65d0a932d781df13d9466bb2824d6ece15b436aa4d2c2c44f4ecd357e9fd3d4c586fc24a14beafa3f2f2489a39a5ac3500306a9fcbb6c444df931a3e8cc57fd1d806b3d84eb5702422c91943148b9bc3f624895f6404de5f4cc361737d99afa26d7a7aedc4ba17e07232d90ab3c6d3f77d062a3e52f86305578795c99c9e2e897fc1e5e58a40ef50c6b08d302c2b3c421a9787213169eedceae79fa829f29032489ec4ea83d931965e0ffc42c1f3d88552f1ac6dd5725a23aa1e65ad257c815df8ec863a678ae82ea86c83ff58096a43e041e7cf58919f58b3c14fb30a87123694726c7bdccfd324d9496b712d1c6db3fa05fd57ab46c2a55a9a092467b773358f66d704901dca50faf0414fd0659378ca32a204a07b5029476a339f111ca257009c422bf869e5108ba018eb23a79a6f9427f9bee3268c46516dbfa5442cc50565ff283923cc1b8e2b7b317840f19c1dd0225f40ab0b8f067f15fda2500a25067d1df19360386ea66f86d4c6b983a01c497cea0c8e8f947f03f3b3376e55a73607fe93519ef2c9345994f2e8fb987475bb2ce82d772f5c477f5711ac74e5fea69484eba57097f9006cc83d2dc651241a37a3264194746a75c02650aceb944451131a93f12ff917c8a16565f113b546d0f805814ef2a9c2481185ee7b35a087880dcda5db6700463e8a54bdf9dcee8e53823cb2d92181c6a946d51f6d513819b595d6272c7c5d414472e14eafd425eb7178cf8f5183222607c4f914093c853693a781c7e563e4814bfedf03bdb5b9391a3883f00eaed12f5a1026e75f0502a872ccb9779838002c034d97720a6a86eab4d62827aa882e569a57f91254e1107adcb597d901288d90f23d601c97f7a662f12ee275f496f2320f16149b77e747ba0b5c92a160ed01972d679be3f3cb167eafa7d186443c51f35c858d1f0374313d3ab515ac1d656520fbbe16fd79fae355622665cedb8f60cb6c72721feee4f75c624e5ebb24b2b6e09cf8f553d0392f9bfd33a9179a89b0c7fc3728cc41efbe24a6ab0e55ea1c226af63e8dc1d5dace17e9f7a2780dff56b186db13477aa50a657077dd3072f847c6d4fe11c64a329bab82a0bf20682ab73b0802193d3</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果站在后端开发的角度来说，现在这款app的逆向已经结束，因为所有的api已经分析出来了，但是如果从Android的角度来说，我们应该在app里面解除这些限制。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://andx.site/2018/12/18/2018-12-18-麻花影视模拟发送请求（完成）/" data-id="cjqevhfmv0045jl24w16uafjj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/逆向/">逆向</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/麻花影视/">麻花影视</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2018-12-17-解密麻花影视视频播放地址（完成）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/17/2018-12-17-解密麻花影视视频播放地址（完成）/" class="article-date">
  <time datetime="2018-12-17T06:46:31.000Z" itemprop="datePublished">2018-12-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>►<a class="article-category-link" href="/categories/Android/逆向/">逆向</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/17/2018-12-17-解密麻花影视视频播放地址（完成）/">2018-12-17-解密麻花影视视频播放地址（完成）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>经过上篇文章的处理重打包，现在app已经能够抓包了，我们抓一下视频播放地址看看。(这是当前热播电视剧《将夜》第一集的播放地址)</p>
<p>目的：解密下面抓包的http 响应体。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">GET /api/app/video/ver2/user/clickPlayVideo_2_2/2/7?videoId=71771&amp;playType=0&amp;time=1545026021155 HTTP/1.1</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Accept: application/json</span><br><span class="line">accessToken: d9a8e5a2bea0d56c0e39baf16f7e43ad35707c79cb28f4d1016f280b6f5deb47</span><br><span class="line">X-Client-NonceStr: A3UOht4UC0</span><br><span class="line">X-Client-IP: 127.0.0.1</span><br><span class="line">X-Client-TimeStamp: 1545026021155</span><br><span class="line">X-Client-Version: 2.3.0</span><br><span class="line">X-Client-Sign: 827a5719ee3efb1e2386d06e41ca64add61fa7dce11452155c14f7c4449a7c73</span><br><span class="line">X-Client-Token: </span><br><span class="line">X-Auth-Token: mb_token:18252297:3c4eaf5d92196fd39968081553be65e8</span><br><span class="line">Host: api.hbzjmf.com</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line">User-Agent: okhttp/3.11.0</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: Tengine</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line">Content-Length: 736</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Date: Mon, 17 Dec 2018 05:53:41 GMT</span><br><span class="line">X-Server-TimeStamp: 1545026021</span><br><span class="line">accessToken: d9a8e5a2bea0d56c0e39baf16f7e43ad35707c79cb28f4d1016f280b6f5deb47</span><br><span class="line">Ali-Swift-Global-Savetime: 1545026021</span><br><span class="line">Via: cache31.l2cm9[54,200-0,M], cache39.l2cm9[55,0], kunlun5.cn36[64,200-0,M], kunlun2.cn36[65,0]</span><br><span class="line">X-Cache: MISS TCP_MISS dirn:-2:-2</span><br><span class="line">X-Swift-SaveTime: Mon, 17 Dec 2018 05:53:41 GMT</span><br><span class="line">X-Swift-CacheTime: 0</span><br><span class="line">Timing-Allow-Origin: *</span><br><span class="line">EagleId: 3c1ce20215450260211213683e</span><br><span class="line"></span><br><span class="line">6cab6feb4e159bdbcb652ffd544a32db308bb2bd2b00f17c9a3d523c69159a0ed7589f602c30130ad2f0213226281767123cac47ca86c8f24511cec75a89b19227ecbae6b5f4ce564561098f2b12d2d48e7f8e38cf6c0641beef2b4c2afa9ac329da660ce6166357dc72baa05f7a27073510401fa4827515b2af58d33e5a2316785322bd141117368b522265cf03bf7eb4e406701df588f76fee55cfe9e2101eab3c29933d64015b25b8d759658c6473c3fd53c39ea15e47cd913ffd2cdc7251c43b9735bf486ef140457046024cd8d7b608e3448a58704657247f50e61fb7259f7302aea6824351455093d614d162aa06cb6bcf4c00ae8ca9d932d09fc8d444a5b121b0b61570a3b544db61eb334affad3abc4060f0720f2ca893217dde2a4957d3066bac004d6ad88bb16077de6771c56332bc2df5046cef7c67292c17011df11da6b22aa27fc237c11aaa6b4f099e2f457e92ae0322c1b548e9a61e628ebb70a747e4c08dda8e77353654a7f80853</span><br></pre></td></tr></table></figure>
<p>哈哈，加密了，别慌客户端肯定有解密代码。</p>
<p>根据url直接找到 Retrofit的定义的地方：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//com.mh.movie.core.mvp.model.a.a</span><br><span class="line">    @GET(&quot;/api/app/video/ver2/user/clickPlayVideo_2_2/&quot;)</span><br><span class="line">    @Headers(&#123;&quot;Content-Type: application/json&quot;&#125;)</span><br><span class="line">    Observable&lt;String&gt; a(@Query(&quot;videoId&quot;) int i, @Query(&quot;playType&quot;) int i2);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>从这个方法的返回值可以发现，Retrofit接到的解析后的http 返回值为String类型。用的是 ： ScalarsConverterFactory，这点很重要</p>
</blockquote>
<p>根据Retrofit的基本用法大概分析一下：</p>
<p>在jadx里面，通过在上面方法上右键–&gt;FindUsage 找到了唯一的应用的地方<code>com.mh.movie.core.mvp.model.b.d</code> 这个类是根据<code>PlayerDao</code> 反编译出来的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public Observable&lt;String&gt; a(int i, int i2) &#123;</span><br><span class="line">    return ((a) this.a.obtainRetrofitService(a.class)).a(i, i2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>依然 方法上右键–&gt;FindUsage 找到 <code>com.mh.movie.core.mvp.model.player.PlayerModel</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public Observable&lt;String&gt; a(int i, int i2) &#123;</span><br><span class="line">     return this.d.a(i, i2);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>这时候我们可以得到一个调用链：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">com.mh.movie.core.mvp.model.player.PlayerModel.a(int, int)</span><br><span class="line">  |--com.mh.movie.core.mvp.model.b.d.a(int, int) //PlayerDao.a(int,int)</span><br><span class="line">    |--com.mh.movie.core.mvp.model.a.a.a(@Query(&quot;videoId&quot;) int i, @Query(&quot;playType&quot;) int i2)//Retrofit 中自定义Service</span><br></pre></td></tr></table></figure>
<p>先猜测一下吧、既然用了mvp那么网络请求的控制应该在 Presenter里面，那么 PlayerModel 肯定是被 PlayerPresenter 调用，根据方法签名，也就是两个int参数，来查找：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">//可疑方法，PlayerPresenter</span><br><span class="line">    public void a(int i, String str, Integer num) &#123;</span><br><span class="line">        ((b) this.d).a(&quot;&quot;, null, 0);</span><br><span class="line">        final int i2 = i;</span><br><span class="line">        final Integer num2 = num;</span><br><span class="line">        final String str2 = str;</span><br><span class="line">        //    protected V d;</span><br><span class="line">        //   Application g;</span><br><span class="line">        ((a) this.c).a(this.G, i).compose(a(this.g, this.d, false))</span><br><span class="line">        .subscribe(new com.mh.movie.core.mvp.model.a.b&lt;VideoAddressResponse&gt;(this.f, new com.google.gson.b.a&lt;BaseResponse&lt;VideoAddressResponse&gt;&gt;() &#123;&#125;.getType()) &#123;</span><br><span class="line">            public void a(VideoAddressResponse videoAddressResponse) &#123;</span><br><span class="line">                PlayerPresenter.this.B = videoAddressResponse;</span><br><span class="line">                int i = 0;</span><br><span class="line">                if (i2 &gt; 0) &#123;</span><br><span class="line">                    PlayerPresenter.this.n = 0;</span><br><span class="line">                    PlayerPresenter.this.j().setPlayType(0);</span><br><span class="line">                    if (i2 == 2) &#123;</span><br><span class="line">                        TableCommodity c = PlayerPresenter.this.c(10);</span><br><span class="line">                        c.hasFlag = 2;</span><br><span class="line">                        c.save();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else if (PlayerPresenter.this.n == -1) &#123;</span><br><span class="line">                    while (i &lt; 4) &#123;</span><br><span class="line">                        if (videoAddressResponse.getM3u8Format().getM3u8Format(i) != null) &#123;</span><br><span class="line">                            PlayerPresenter.this.n = i;</span><br><span class="line">                            break;</span><br><span class="line">                        &#125;</span><br><span class="line">                        i++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>
<p>这只是根据方法签名和rxjava的基本逻辑进行猜测的。我们来动态调试一下。</p>
<p>断点打在上面的方法上。<code>((a) this.c).a(this.G, i)</code>在这一行上，我们，进入这个a里面看看是不是调用了我们一开始分析的。果然是这个方法，看下调用堆栈：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a:696, PlayerPresenter (com.mh.movie.core.mvp.presenter.player)</span><br><span class="line">a:323, PlayerPresenter (com.mh.movie.core.mvp.presenter.player)</span><br><span class="line">a:539, PlayerPresenter (com.mh.movie.core.mvp.presenter.player)</span><br><span class="line">a:670, PlayerPresenter$1 (com.mh.movie.core.mvp.presenter.player)</span><br><span class="line">a:617, PlayerPresenter$1 (com.mh.movie.core.mvp.presenter.player)</span><br><span class="line">a:69, b (com.mh.movie.core.mvp.model.a)</span><br><span class="line">onNext:30, b (com.mh.movie.core.mvp.model.a)</span><br><span class="line">//......</span><br></pre></td></tr></table></figure>
<p>这个时候获取到的是真实的播放地址，而我们抓包抓到的返回值明显是加过密的，那么解密的过程很有可能在OkHttp的 Interceptor 中，还有可能在 在 Retrofit的 ConverterFactory 中。我们先来分析在 Intercepter中的情况。。。</p>
<blockquote>
<p>TMD,分析这个项目难就难在他用了依赖注入框架Dagger。我特么不会用这个东西，好多重要的对象的构建我找不到对应的地方，比如OkhttpClient和Retrofit的创建，这里面肯定有好多全局设置，我在这个项目里面找不到他们如何创建的很多只能靠猜测，我这就滚去学习去。</p>
</blockquote>
<p>看这个类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// com.jess.arms.b.b.f   注意这个方法的最后一个参数</span><br><span class="line">    @Singleton</span><br><span class="line">    static OkHttpClient a(Application application, @Nullable b bVar, Builder builder, Interceptor interceptor, @Nullable List&lt;Interceptor&gt; list, @Nullable final com.jess.arms.http.b bVar2) &#123;</span><br><span class="line">        a aVar = new a();</span><br><span class="line">        builder.proxy(Proxy.NO_PROXY).connectTimeout(10, TimeUnit.SECONDS).readTimeout(10, TimeUnit.SECONDS).sslSocketFactory(a(aVar), aVar).hostnameVerifier(new e()).addNetworkInterceptor(interceptor);</span><br><span class="line">        if (bVar2 != null) &#123;</span><br><span class="line">            builder.addInterceptor(new Interceptor() &#123;</span><br><span class="line">                public Response intercept(Chain chain) throws IOException &#123;</span><br><span class="line">                //这里会有处理，我们找到这个bVar2 的实现类,然后断点调试一下，发现返回值依然是加密的</span><br><span class="line">                    return chain.proceed(bVar2.a(chain, chain.request()));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        if (list != null) &#123;</span><br><span class="line">            for (Interceptor addInterceptor : list) &#123;</span><br><span class="line">                builder.addInterceptor(addInterceptor);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (bVar != null) &#123;</span><br><span class="line">            bVar.a(application, builder);</span><br><span class="line">        &#125;</span><br><span class="line">        return builder.build();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>找到 bVar2的实现类 <code>.class public Lcom/mh/movie/core/app/i;</code>，那么剩下的还有就是参数 list 和 参数 interceptor 了。。。我现在找不到这两个东西是怎么注入进来的。</p>
<p>再回过头来想一想，我门虽然不知道这个东西怎么注入到Retrofit中的，但是我们可以动态调试Retrofit，观察一下他的OKhttpClient里面的额 Interceptor 。看 PlayerPresenter 里面的调用，打上断点观察 Retrofit类。对应这个方法 <code>.method public a(ILjava/lang/String;Ljava/lang/Integer;)V</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//调用链</span><br><span class="line">((a) this.c).a(this.G, i)   //com.mh.movie.core.mvp.a.b.a.a(this.G, i)这个是 PlayerModel 类的接口</span><br><span class="line">    |--Lcom/mh/movie/core/mvp/model/player/PlayerModel.a(this.G, i)</span><br><span class="line">       |--Lcom/mh/movie/core/mvp/model/b/d;-&gt;a(II)（PlayerDao.java）</span><br><span class="line">         |-- ((a) this.a.obtainRetrofitService(a.class)).a(i, i2);//fuck ,fuck ,里面的 构建又是用 Dagger搞的。fuck</span><br><span class="line">         //既然this.a能够构建Retrofit的Service，那么this.a 里面很有可能包含Retrofit这个类</span><br></pre></td></tr></table></figure>
<p>分析这个this.a 这是个IRepositoryManager ，根据程序员命名规范，那么这个玩意的实现类很有可能叫做 <code>RepositoryManager</code> 其次叫做 <code>RepositoryManagerImpl</code> jdax全局类搜索。得到 <code>com.jess.arms.integration.RepositoryManager</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">//this.a 就是这个类的对象我们要的 Retrofit 对象是this.a.mRetrofit.get()</span><br><span class="line">@Singleton</span><br><span class="line">public class RepositoryManager implements IRepositoryManager &#123;</span><br><span class="line">    @Inject</span><br><span class="line">    Application mApplication;</span><br><span class="line">    private Cache&lt;String, Object&gt; mCacheServiceCache;</span><br><span class="line">    @Inject</span><br><span class="line">    Factory mCachefactory;</span><br><span class="line">    @Inject</span><br><span class="line">    a&lt;Retrofit&gt; mRetrofit;</span><br><span class="line">    private Cache&lt;String, Object&gt; mRetrofitServiceCache;</span><br><span class="line">    @Inject</span><br><span class="line">    a&lt;j&gt; mRxCache;</span><br><span class="line"></span><br><span class="line">    public synchronized &lt;T&gt; T obtainRetrofitService(Class&lt;T&gt; cls) &#123;</span><br><span class="line">        T t;</span><br><span class="line">        if (this.mRetrofitServiceCache == null) &#123;</span><br><span class="line">            this.mRetrofitServiceCache = this.mCachefactory.build(CacheType.RETROFIT_SERVICE_CACHE);</span><br><span class="line">        &#125;</span><br><span class="line">        g.a(this.mRetrofitServiceCache, (Object) &quot;Cannot return null from a Cache.Factory#build(int) method&quot;);</span><br><span class="line">        t = this.mRetrofitServiceCache.get(cls.getCanonicalName());</span><br><span class="line">        if (t == null) &#123;</span><br><span class="line">            t = ((Retrofit) this.mRetrofit.get()).create(cls);</span><br><span class="line">            this.mRetrofitServiceCache.put(cls.getCanonicalName(), t);</span><br><span class="line">        &#125;</span><br><span class="line">        return t;</span><br><span class="line">    &#125;</span><br><span class="line">    //.......</span><br></pre></td></tr></table></figure>
<p>上面的 this.a 就是类<code>com.jess.arms.integration.RepositoryManager</code>的对象我们要的 Retrofit 对象是this.a.mRetrofit.get()的到的值。</p>
<p>动态调试，断点打在 <code>.class public Lcom/mh/movie/core/mvp/model/b/d;</code>的 <code>.method public a(II)Lio/reactivex/Observable;</code>方法上，然后分析内存里面的值。</p>
<p><img src="https://note.youdao.com/yws/public/resource/2aaa20465ab7ce4c8e624e2e5969be9b/xmlnote/26EE04E750FE4D44833A88AD189C7449/1533" alt=""></p>
<p>Interceptor 分两个：interceptors 和 networkInterceptors 分别对应：<br>addInterceptor 和 addNetworkInterceptor</p>
<p>interceptors 有两个：com.jess.arms.b.b.f$1里面的匿名对象和 RetrofitUrlManager$1 并没有解密。 </p>
<p>我们去看 networkInterceptors 。这个数组也有两个：</p>
<p><code>class com.jess.arms.http.log.RequestInterceptor</code> 和 <code>class me.jessyan.progressmanager.b$1</code></p>
<p>调试发现这个  RequestInterceptor  里面并不会改变这个加密字符串。</p>
<p>从动态调试的角度来说，解密操作不是OkhttpClient的 Interceptor引起的。但是我依然不太确定。接下来，去了解Retrofit的源码，去找一下，Okhttp是如何把数据递交到Retrofit的。然后hook这个地方的代码，用来确定解密操作倒是是不是Okhttp操作的。。。。。</p>
<p>而 只有从内存状态来看只有四个</p>
<ol>
<li>class retrofit2.BuiltInConverters</li>
<li>class retrofit2.converter.scalars.ScalarsConverterFactory</li>
<li>class com.jess.arms.b.b.ab   </li>
<li>class retrofit2.converter.gson.GsonConverterFactory</li>
</ol>
<p>hook 一下这几个 Converter 具体的执行，观察这个项目调用了哪个，并且打印Converter 转换之后的返回值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">private static void hookConverter(final XC_LoadPackage.LoadPackageParam loadPackageParam) &#123;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        Class GsonResponseBodyConverter = loadPackageParam.classLoader.loadClass(&quot;retrofit2.converter.gson.GsonResponseBodyConverter&quot;);</span><br><span class="line">        Class ResponseBody = loadPackageParam.classLoader.loadClass(&quot;okhttp3.ResponseBody&quot;);</span><br><span class="line"></span><br><span class="line">        XposedHelpers.findAndHookMethod(GsonResponseBodyConverter,</span><br><span class="line">                &quot;convert&quot;,</span><br><span class="line">                ResponseBody,</span><br><span class="line">                new XC_MethodHook() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                        Log.d(&quot;Q_M&quot;, &quot;GsonResponseBodyConverter--convert--&gt;&quot; + param.args[0]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">        Class StringResponseBodyConverter = loadPackageParam.classLoader.loadClass(&quot;retrofit2.converter.scalars.ScalarResponseBodyConverters$StringResponseBodyConverter&quot;);</span><br><span class="line">        Log.d(&quot;Q_M&quot;, &quot;找到类:&quot; + StringResponseBodyConverter);</span><br><span class="line">        XposedHelpers.findAndHookMethod(StringResponseBodyConverter,</span><br><span class="line">                &quot;convert&quot;,</span><br><span class="line">                ResponseBody,</span><br><span class="line">                new XC_MethodHook() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                        super.afterHookedMethod(param);</span><br><span class="line">                        Log.d(&quot;Q_M&quot;, &quot;StringResponseBodyConverter--convert--&gt;&quot; + param.getResult().toString());</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行发现GsonResponseBodyConverter 里面的方法并没有被hook到，也就是没有执行GsonResponseBodyConverter的转换过程。而是调用了<code>ScalarResponseBodyConverters$StringResponseBodyConverter</code> 所以 Retrofit 接收到的转换后的结果是个字符串，并且这个字符串依然是加密状态的。也就是说字符串的解析（解析成相应对象），或者字符串解密都是在Retrofit获取到结果之后操作的，看Rxjava如何处理这个str的，这个处理过程肯定在Rxjava的subscribe的 Observer 里面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">//PlayerPresenter 类中的可疑方法</span><br><span class="line">public void a(int i, String str, Integer num) &#123;</span><br><span class="line">    ((b) this.d).a(&quot;&quot;, null, 0);</span><br><span class="line">    final int i2 = i;</span><br><span class="line">    final Integer num2 = num;</span><br><span class="line">    final String str2 = str;</span><br><span class="line">    //    protected V d;</span><br><span class="line">    //   Application g;</span><br><span class="line">    ((a) this.c).a(this.G, i).compose(a(this.g, this.d, false))</span><br><span class="line">    .subscribe(new com.mh.movie.core.mvp.model.a.b&lt;VideoAddressResponse&gt;(this.f, new com.google.gson.b.a&lt;BaseResponse&lt;VideoAddressResponse&gt;&gt;()&#123;&#125;.getType()) &#123;</span><br><span class="line">        public void a(VideoAddressResponse videoAddressResponse) &#123;</span><br><span class="line">            PlayerPresenter.this.B = videoAddressResponse;</span><br><span class="line">            int i = 0;</span><br><span class="line">            if (i2 &gt; 0) &#123;</span><br><span class="line">                PlayerPresenter.this.n = 0;</span><br><span class="line">                PlayerPresenter.this.j().setPlayType(0);</span><br><span class="line">                if (i2 == 2) &#123;</span><br><span class="line">                    TableCommodity c = PlayerPresenter.this.c(10);</span><br><span class="line">                    c.hasFlag = 2;</span><br><span class="line">                    c.save();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else if (PlayerPresenter.this.n == -1) &#123;</span><br><span class="line">                while (i &lt; 4) &#123;</span><br><span class="line">                    if (videoAddressResponse.getM3u8Format().getM3u8Format(i) != null) &#123;</span><br><span class="line">                        PlayerPresenter.this.n = i;</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<p>看这个类 <code>new com.mh.movie.core.mvp.model.a.b&lt;VideoAddressResponse&gt;(this.f, new com.google.gson.b.a&lt;BaseResponse&lt;VideoAddressResponse&gt;&gt;(){}.getType()</code></p>
<p>这个 <code>this.f</code> 是 <code>RxErrorHandler f;</code> 也就是错误处理，不用管它。<br>第二个参数是json要解析成的对象的类型。所以猜测str解析成对象的过程很可能在这里面执行。去看这个类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//public abstract class b&lt;E&gt; implements Observer&lt;String&gt; </span><br><span class="line">//这是这个类里面的核心方法，看到变量的命名了吗，这就是解密的地方</span><br><span class="line">    /* renamed from: a */</span><br><span class="line">    public void onNext(String str) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            String decryptHex = AesUtil.decryptHex(str, AesUtil.getKey(false));</span><br><span class="line">            if (decryptHex != null) &#123;</span><br><span class="line">                str = decryptHex;</span><br><span class="line">            &#125;</span><br><span class="line">            com.mh.movie.core.mvp.ui.b.x = null;</span><br><span class="line">            BaseResponse baseResponse = (BaseResponse) new f().a().c().a(str, this.c);</span><br><span class="line">            if (baseResponse.isSuccess()) &#123;</span><br><span class="line">                a(baseResponse.getData());</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            b(baseResponse.getCode());</span><br><span class="line">            StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line">            stringBuilder.append(baseResponse.getDescription());</span><br><span class="line">            stringBuilder.append(baseResponse.getCode());</span><br><span class="line">            c(stringBuilder.toString());</span><br><span class="line">        &#125; catch (Throwable th) &#123;</span><br><span class="line">            a.a(th);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到对字符串的加解密完全是java代码，而且还是个独立的工具类，那就很舒服了。我们抽取出来解密一下，我们文章最开始用Charles获取的加密的http返回值。在构造这个 AesUtil 这个工具类的时候，其他参数都很简单，但是构建aes key的时候 有个参数 <code>String packageId = RHelp.getPackageId();</code> 这个东西的看下如何构建的：</p>
<p>//在jadx中不断使用 find usage 就能找到，在 MHApplication 里面初始化的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//看下这个方法，其实很简单，就是从 Assets 文件夹下面读取一个文件 pack_info</span><br><span class="line">//但是呢这个文件内容是加密后的一个字符串，我们用默认密钥，解密这个字符串，可以得到一个json</span><br><span class="line">//AesUtil.getKey(true) 这个传入参数true表示使用默认密钥</span><br><span class="line">    private void g() throws Exception &#123;</span><br><span class="line">        InputStream open = getAssets().open(&quot;pack_info&quot;);</span><br><span class="line">        byte[] bArr = new byte[open.available()];</span><br><span class="line">        open.read(bArr);</span><br><span class="line">        open.close();</span><br><span class="line">        String str = new String(bArr, &quot;utf8&quot;);</span><br><span class="line">        String decryptHex = AesUtil.decryptHex(str, AesUtil.getKey(true));</span><br><span class="line">        if (decryptHex != null) &#123;</span><br><span class="line">            str = decryptHex;</span><br><span class="line">        &#125;</span><br><span class="line">        //这个e是混淆后的Gson类</span><br><span class="line">        RHelp.initInfo((PackInfo) new com.google.gson.e().a(str, PackInfo.class));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>我们现在解密下在文章最开始得到的加密后的http返回结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String str = &quot;6cab6feb4e159bdbcb652ffd544a32db308bb2bd2b00f17c9a3d523c69159a0ed7589f602c30130ad2f0213226281767123cac47ca86c8f24511cec75a89b19227ecbae6b5f4ce564561098f2b12d2d48e7f8e38cf6c0641beef2b4c2afa9ac329da660ce6166357dc72baa05f7a27073510401fa4827515b2af58d33e5a2316785322bd141117368b522265cf03bf7eb4e406701df588f76fee55cfe9e2101eab3c29933d64015b25b8d759658c6473c3fd53c39ea15e47cd913ffd2cdc7251c43b9735bf486ef140457046024cd8d7b608e3448a58704657247f50e61fb7259f7302aea6824351455093d614d162aa06cb6bcf4c00ae8ca9d932d09fc8d444a5b121b0b61570a3b544db61eb334affad3abc4060f0720f2ca893217dde2a4957d3066bac004d6ad88bb16077de6771c56332bc2df5046cef7c67292c17011df11da6b22aa27fc237c11aaa6b4f099e2f457e92ae0322c1b548e9a61e628ebb70a747e4c08dda8e77353654a7f80853&quot;;</span><br><span class="line">String decryptHex = AesUtil.decryptHex(str, AesUtil.getKey(false));</span><br><span class="line"></span><br><span class="line">System.out.println(&quot;decrypt:--&gt;&quot; + decryptHex);</span><br></pre></td></tr></table></figure>
<p>输出结果如下（为了方便阅读我把结果格式化了）：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"code"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"description"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"imgAddr"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"videoAddr"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"data"</span>: &#123;</span><br><span class="line">        <span class="attr">"m3u8PlayUrl"</span>: <span class="string">"http://v.gmitking.com/mahua/2332/rpup19lfbuf2skc/"</span>,</span><br><span class="line">        <span class="attr">"m3u8Format"</span>: &#123;</span><br><span class="line">            <span class="attr">"360P"</span>: <span class="string">"rpup19lfbuf2skc_1_eb8b25960fd046ddbc925a8673cb0c4e.m3u8"</span>,</span><br><span class="line">            <span class="attr">"480P"</span>: <span class="string">"rpup19lfbuf2skc_1_f8a6196027d24e7aac871627ab86f69a.m3u8"</span>,</span><br><span class="line">            <span class="attr">"free"</span>: <span class="string">"rpup19lfbuf2skc_1_97fc2b818def488695ea74432329b055.m3u8"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>好了视频480p的播放地址就是：<a href="http://v.gmitking.com/mahua/2332/rpup19lfbuf2skc/rpup19lfbuf2skc_1_f8a6196027d24e7aac871627ab86f69a.m3u8" target="_blank" rel="noopener">http://v.gmitking.com/mahua/2332/rpup19lfbuf2skc/rpup19lfbuf2skc_1_f8a6196027d24e7aac871627ab86f69a.m3u8</a></p>
<p>找个能播放 m3u8 视频格式的播放器，把这个链接丢进去就能播放了。我用的<a href="https://github.com/lhc70000/iina" target="_blank" rel="noopener">IINA</a></p>
<blockquote>
<p>总结一下，其实一开始的分析走偏走远了，主要没有仔细分析，先入为主的思想影响太深，在看到 Retrofit的Service里面定义所有的返回值类型为String的时候就该想到 Retrofit 用的不是 GsonConverterFactory 做解析的。一般来说我们会在在Interceptor 或者在自定义Converter里面加解密。而这个人的开发显然选择了一种比较简单粗暴的方式，就是在Retrofit的Service里面定义所有的返回值类型为String，然后在 RxJava 的 Observer 里面统一处理字符串，要么解密要么解析成对象。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://andx.site/2018/12/17/2018-12-17-解密麻花影视视频播放地址（完成）/" data-id="cjqevhb730040jl24irxg2vfw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/逆向/">逆向</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/麻花影视/">麻花影视</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2018-12-16-绕过麻花影视抓包检测（完成）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/16/2018-12-16-绕过麻花影视抓包检测（完成）/" class="article-date">
  <time datetime="2018-12-16T06:46:31.000Z" itemprop="datePublished">2018-12-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>►<a class="article-category-link" href="/categories/Android/逆向/">逆向</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/16/2018-12-16-绕过麻花影视抓包检测（完成）/">2018-12-16-绕过麻花影视抓包检测（完成）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>目的：能够用Charles或者fiddler抓包</p>
<p>本来想抓包看看他的api请求，然后分析api加密和参数等问题呢，结果挂上Charles之后竟然界面没有数据并且 Toast 提示 <code>请关闭代理重试</code>。</p>
<p>我能猜测到的引起这种现象的有两种情况：1，证书不匹配，项目固定了证书，或者服务端对客户端证书进行了验证；2，项目里面有代理检测</p>
<p>进一步猜测并测试，我们再尝试一个别的代理。用手机上的app，packet capture尝试一下结果竟然可以访问，而且也能够抓到数据。所以猜测证书引起的可能性不大。</p>
<p>并且它Toast 提示 <code>请关闭代理重试</code>。这一行提示出卖了他。说明他知道我挂了代理，那么它里面很有可能进行了网络代理检测。</p>
<p>网上搜一下判断当前wifi是否使用了代理的基本方法，都是下面这段代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isWifiProxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> IS_ICS_OR_LATER = Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.ICE_CREAM_SANDWICH;</span><br><span class="line">    String proxyAddress;</span><br><span class="line">    <span class="keyword">int</span> proxyPort;</span><br><span class="line">    <span class="keyword">if</span> (IS_ICS_OR_LATER) &#123;</span><br><span class="line">        proxyAddress = System.getProperty(<span class="string">"http.proxyHost"</span>);</span><br><span class="line">        String portStr = System.getProperty(<span class="string">"http.proxyPort"</span>);</span><br><span class="line">        proxyPort = Integer.parseInt((portStr != <span class="keyword">null</span> ? portStr : <span class="string">"-1"</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        proxyAddress = android.net.Proxy.getHost(context);</span><br><span class="line">        proxyPort = android.net.Proxy.getPort(context);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (!TextUtils.isEmpty(proxyAddress)) &amp;&amp; (proxyPort != -<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>jadx 全局搜索 <code>System.getProperty(&quot;http.proxyHost&quot;);</code></p>
<p>得到 <code>com.mh.movie.core.app.i</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">//不就是特么这个方法吗、</span><br><span class="line">    private boolean a(Context context) &#123;</span><br><span class="line">        CharSequence property;</span><br><span class="line">        int parseInt;</span><br><span class="line">        if ((VERSION.SDK_INT &gt;= 14 ? 1 : null) != null) &#123;</span><br><span class="line">            property = System.getProperty(&quot;http.proxyHost&quot;);</span><br><span class="line">            String property2 = System.getProperty(&quot;http.proxyPort&quot;);</span><br><span class="line">            if (TextUtils.isEmpty(property2)) &#123;</span><br><span class="line">                property2 = &quot;-1&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">            parseInt = Integer.parseInt(property2);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            String host = Proxy.getHost(context);</span><br><span class="line">            parseInt = Proxy.getPort(context);</span><br><span class="line">            property = host;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line">        stringBuilder.append(&quot;proxyAddress : &quot;);</span><br><span class="line">        stringBuilder.append(property);</span><br><span class="line">        stringBuilder.append(&quot;, port : &quot;);</span><br><span class="line">        stringBuilder.append(parseInt);</span><br><span class="line">        Log.i(&quot;checkWifiProxy&quot;, stringBuilder.toString());</span><br><span class="line">        if (TextUtils.isEmpty(property) || parseInt == -1) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>直接修改 <code>.class public Lcom/mh/movie/core/app/i;</code> 里面的代码为,直接返回false就行了，表明没有是用代理：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.method</span><span class="keyword"> private</span> a(<span class="class">Landroid/content/Context;</span>)Z</span><br><span class="line"><span class="keyword">    .locals</span> 7</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> const/4 </span>v1, 0x0</span><br><span class="line"></span><br><span class="line">   <span class="built_in"> return </span>v1</span><br><span class="line"><span class="keyword">.end method</span></span><br></pre></td></tr></table></figure>
<p>本来以为事情到这里就结束了，但是，TMD 、虽然能访问网络，但是抓不到包，抓不到包。。。。。why？</p>
<blockquote>
<p>对于一些常用的网络库，其实是提供了我们设置的代理的接口，我们只需要将其设置成无代理的模式，它就不会去应用系统默认的代理了。</p>
</blockquote>
<p>就拿比较常用的 OkHttp 来举例，在初始化的时候，就可以通过 proxy() 方法，为 OkHttp 设置一个代理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var httpBuilder = OkHttpClient.Builder() </span><br><span class="line">                .addInterceptor(defaultInterceptor()) </span><br><span class="line">                .connectTimeout(DEFAULT_TIMEOUT, TimeUnit.MILLISECONDS) </span><br><span class="line">                .writeTimeout(DEFAULT_TIMEOUT, TimeUnit.MILLISECONDS) </span><br><span class="line">                .readTimeout(DEFAULT_TIMEOUT, TimeUnit.MILLISECONDS)</span><br><span class="line">                .proxy(Proxy.NO_PROXY)</span><br></pre></td></tr></table></figure>
<p>全局搜索<code>Proxy.NO_PROXY</code> 这个玩意，都删了。</p>
<p>其实最后锁定到<br>是这个<code>com.jess.arms.b.b.f</code> 类里面的设置引起，但是目前我也没有办法直接锁定到这个类，因为这个项目用了Dagger 。我是尝试出来的，jadx 全局搜索一共就是四五处用到这个NO_PROXY 的地方。然后一个个的改，而这个类最复杂，我放到最后才改。结果发现是这个类影响的。</p>
<p>好了终于可以，终于可以能够抓到包了。</p>
<blockquote>
<p>总结一下，他这里的抓包防护总共有两处1，检查是不是用了Http代理，如果是，那么客户端不再发送网络请求，2，通过Okhttp 设置默认代理，那么就不会走我们的Charles代理了。设计很精巧</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://andx.site/2018/12/16/2018-12-16-绕过麻花影视抓包检测（完成）/" data-id="cjqevh78w003vjl24n4bu5890" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/逆向/">逆向</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/麻花影视/">麻花影视</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2018-12-15-分析麻花影视点击视频播放按钮操作（完成）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/15/2018-12-15-分析麻花影视点击视频播放按钮操作（完成）/" class="article-date">
  <time datetime="2018-12-15T06:46:31.000Z" itemprop="datePublished">2018-12-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>►<a class="article-category-link" href="/categories/Android/逆向/">逆向</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/15/2018-12-15-分析麻花影视点击视频播放按钮操作（完成）/">2018-12-15-分析麻花影视点击视频播放按钮操作（完成）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这篇文章没啥重要目的，主要想分析下播放器，和Android 上分析view的基本功。可以跳过不看。</p>
<p>发现他的播放器用的开源播放器 <a href="https://github.com/CarGuo/GSYVideoPlayer" target="_blank" rel="noopener">GSYVideoPlayer</a> 那为了快速逆向分析可以先去看下这个开源库的基本代码逻辑</p>
<p>从播放页面的点击播放按钮入手： PlayerActivity</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--activity_player.xml--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">com.mh.movie.core.mvp.ui.activity.player.MHVideoPlayer</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:id</span>=<span class="string">"@id/mh_video_player"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:layout_height</span>=<span class="string">"@dimen/post_media_height"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>public class MHPlayerLogicView extends MHVideoPlayer</code></p>
<p>看他的父类，MHVideoPlayer、这里面有可能存在播放器控制的部分。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public int getLayoutId() &#123;</span><br><span class="line">    return R.layout.view_video_player;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看 view_video_player 里面的代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;RelativeLayout</span><br><span class="line">    android:id=&quot;@id/rl_player_play_control&quot;</span><br><span class="line">    android:layout_width=&quot;fill_parent&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:layout_marginBottom=&quot;-32.0dip&quot;</span><br><span class="line">    android:clipChildren=&quot;false&quot;</span><br><span class="line">    android:clipToPadding=&quot;false&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;ImageView</span><br><span class="line">        android:id=&quot;@id/start&quot;</span><br><span class="line">        android:layout_width=&quot;56.0dip&quot;</span><br><span class="line">        android:layout_height=&quot;32.0dip&quot;</span><br><span class="line">        android:layout_centerVertical=&quot;true&quot;</span><br><span class="line">        android:paddingLeft=&quot;16.0dip&quot;</span><br><span class="line">        android:paddingRight=&quot;16.0dip&quot;</span><br><span class="line">        android:paddingBottom=&quot;8.0dip&quot;</span><br><span class="line">        android:src=&quot;@mipmap/ico_player_play&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>因为项目用了ButterKnife，所以，根据命名规范，这个MHVideoPlayer 肯定有个  MHVideoPlayer_ViewBinding 与其对应。这里面管理这在 MHVideoPlayer 用到的所有的view的id和view的对应关系。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">|-FrameLayout</span><br><span class="line">    |-GSYTextureRenderView</span><br><span class="line">        |-GSYVideoView</span><br><span class="line">            |-GSYVideoControlView</span><br><span class="line">                |-GSYBaseVideoPlayer</span><br><span class="line">                    |-GSYVideoPlayer</span><br><span class="line">                        |-StandardGSYVideoPlayer</span><br><span class="line">                            |-DanmakuVideoPlayer</span><br><span class="line">                                |-LandLayoutVideo</span><br><span class="line">                                    |-MHVideoPlayer</span><br><span class="line">                                        |-MHPlayerLogicView</span><br></pre></td></tr></table></figure></p>
<p>jadx中全局搜索 R.id.start</p>
<p><img src="https://note.youdao.com/yws/public/resource/2aaa20465ab7ce4c8e624e2e5969be9b/xmlnote/BEC4A879C0E44423BFCF545297CA9C95/1142" alt=""></p>
<p>我们在这个地方打个断点动态调试一下观察一下，点击暂停按钮，观察会不会触发这个断点。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public void onClick(View view) &#123;</span><br><span class="line">    if (!AntiShake.check(Integer.valueOf(view.getId()))) &#123;</span><br><span class="line">        int id = view.getId();</span><br><span class="line">        if (this.mHideKey &amp;&amp; this.mIfCurrentIsFullscreen) &#123;</span><br><span class="line">            CommonUtil.hideNavKey(this.mContext);</span><br><span class="line">        &#125;</span><br><span class="line">        if (id == R.id.start) &#123;   //断点下在这个地方</span><br><span class="line">            clickStartIcon();</span><br><span class="line">        &#125; else if (id == R.id.surface_container &amp;&amp; this.mCurrentState == 7) &#123;</span><br><span class="line">    //。。。省略无用代码</span><br></pre></td></tr></table></figure>
<p>发现确实能够暂停，执行clickStartIcon(); 里面的逻辑。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://andx.site/2018/12/15/2018-12-15-分析麻花影视点击视频播放按钮操作（完成）/" data-id="cjqevh4aw003qjl24rk0mxe7n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/逆向/">逆向</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/麻花影视/">麻花影视</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2018-12-14-去掉麻花影视闪屏广告（完成）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/14/2018-12-14-去掉麻花影视闪屏广告（完成）/" class="article-date">
  <time datetime="2018-12-14T06:46:31.000Z" itemprop="datePublished">2018-12-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>►<a class="article-category-link" href="/categories/Android/逆向/">逆向</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/14/2018-12-14-去掉麻花影视闪屏广告（完成）/">2018-12-14-去掉麻花影视闪屏广告（完成）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>目的：去掉每次启动的5秒等待</p>
<p>妈的每次测试进入都要等待5秒，等五秒就算了，还要手动点击进入。5秒浪费人生宝贵时间。先把它干掉。</p>
<p>猜测一下好，这个玩意等待需要时间，等待完成，肯定要进入主Activity，获取下这个主要Activity的名字，MainActivity，然后在SplashActivity里面查找一下，发现是在h方法里面，那好说了，我们在他源码启动等待计时器的地方，直接调用这个h方法就行了。h方法签名如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private void h() &#123;</span><br><span class="line">    if (this.f &amp;&amp; !this.i) &#123;   //要想调用h方法，这两个判断条件必须通过</span><br><span class="line">        if (this.m != null) &#123;</span><br><span class="line">            this.m.cancel();</span><br><span class="line">        &#125;</span><br><span class="line">        startActivity(new Intent(this, MainActivity.class));</span><br><span class="line">        overridePendingTransition(R.anim.fade_in, R.anim.fade_out);</span><br><span class="line">        finish();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就是分析发现，g方法是启动定时器的地方，而g被f调用，那么我们直接在f里面调用h就行了，但是h里面会有if判断，让判断为true就行了。</p>
<p>这种方式很简单，但是发现还是会有个”大美女”一闪而过，我特么每次不想看到这个东西。我们来看下这个美女怎么出来的。</p>
<p>通过monitor分析，得到显示图片的ImageView 的id为：</p>
<p><code>com.amahua.ompimdrt:id/splash_bg</code>  </p>
<p>所以找到设置图片的地方就ok了，去SplashActivity里面看看，搜索splash_bg 得到 ，this.c ,然后搜索this.c</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">//根据变量名猜测这玩意就是设置广告的地方，直接把这个方法屏蔽掉。</span><br><span class="line">    public void a(long j, List&lt;AdsResponse&gt; list, boolean z) &#123;</span><br><span class="line">        int i = 1;</span><br><span class="line">        this.g = true;</span><br><span class="line">        this.h = z;</span><br><span class="line">        //从这个命名可以看出，这个项目用了mvp架构，</span><br><span class="line">        //那么这个方法，从结构上猜测应该是网络请求之后的回调，</span><br><span class="line">        //那么应该属于view的接口方法，那么应该在 SplashPresenter 里面调用。</span><br><span class="line">        //根据继承关系查看，这个方法是在 com.mh.movie.core.mvp.a.ba.b 里面声明的</span><br><span class="line">        ((SplashPresenter) this.b).e();</span><br><span class="line">        ((SplashPresenter) this.b).g();</span><br><span class="line">        if (!(list == null || list.isEmpty())) &#123;</span><br><span class="line">            int c = d.c(this, com.mh.movie.core.mvp.ui.b.w);</span><br><span class="line">            int i2 = 0;</span><br><span class="line">            if (this.e == null || !((AdsResponse) this.e.get(0)).getThumbnailUrl().equals(((AdsResponse) list.get(0)).getThumbnailUrl())) &#123;</span><br><span class="line">                d.a((Context) this, com.mh.movie.core.mvp.ui.b.q, new e().a((Object) list));</span><br><span class="line">                while (i &lt; list.size()) &#123;</span><br><span class="line">                    if (!TextUtils.isEmpty(((AdsResponse) list.get(i)).getThumbnailUrl())) &#123;</span><br><span class="line">                        Glide.with((FragmentActivity) this).load(((AdsResponse) list.get(i)).getThumbnailUrl()).preload();</span><br><span class="line">                    &#125;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                i2 = (c + 1) % list.size();</span><br><span class="line">            &#125;</span><br><span class="line">            d.a((Context) this, com.mh.movie.core.mvp.ui.b.w, i2);</span><br><span class="line">            this.d = (AdsResponse) list.get(i2);</span><br><span class="line">            Glide.with((FragmentActivity) this).load(this.d.getThumbnailUrl()).apply(new RequestOptions().placeholder(this.c.getDrawable())).into(this.c);</span><br><span class="line">            com.mh.movie.core.mvp.ui.b.c = d.b(this.r, &quot;is_first_partner&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        f();//倒计时在这个方法调用的g方法里面。所以如果屏蔽当前方法，那么这个启动主界面的操作必须手动调用</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>直接在a方法里面打断点，然后运行项目观察调用堆栈</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.method</span><span class="keyword"> public</span> a(J<span class="class">Ljava/util/List;</span>Z)V</span><br><span class="line"><span class="keyword">    .locals</span> 2</span><br><span class="line"><span class="keyword">    .annotation</span><span class="keyword"> system</span> <span class="class">Ldalvik/annotation/Signature;</span></span><br><span class="line">        value = &#123;</span><br><span class="line">            <span class="string">"(J"</span>,</span><br><span class="line">            <span class="string">"Ljava/util/List&lt;"</span>,</span><br><span class="line">            <span class="string">"Lcom/mh/movie/core/mvp/model/entity/response/AdsResponse;"</span>,</span><br><span class="line">            <span class="string">"&gt;;Z)V"</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">    .end annotation</span></span><br><span class="line"><span class="comment">#只是为了查看调用堆栈，断点打在下面这行就行</span></span><br><span class="line">   <span class="built_in"> const/4 </span>p1, 0x1</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 332</span><br><span class="line">   <span class="built_in"> iput-boolean </span>p1, p0, <span class="class">Lcom/mh/movie/core/mvp/ui/activity/SplashActivity;</span>-&gt;g:Z</span><br><span class="line">    <span class="comment">##。。。。。 省略无用代码</span></span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a:332, SplashActivity (com.mh.movie.core.mvp.ui.activity)</span><br><span class="line"># $1 理论上来说是这个类里面的第一个匿名内部类</span><br><span class="line">a:122, SplashPresenter$1 (com.mh.movie.core.mvp.presenter)</span><br><span class="line">a:103, SplashPresenter$1 (com.mh.movie.core.mvp.presenter)</span><br><span class="line">a:69, b (com.mh.movie.core.mvp.model.a)</span><br><span class="line">##....省略无用堆栈</span><br></pre></td></tr></table></figure>
<p>根据特征码，可以定位到如下方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">    public void a(LoginRequest loginRequest, boolean z) &#123;</span><br><span class="line">        ((a) this.c).a(loginRequest).compose(a(this.f, this.d, z)).subscribe(new com.mh.movie.core.mvp.model.a.b&lt;LoginResponse&gt;(this.e, new com.google.gson.b.a&lt;BaseResponse&lt;LoginResponse&gt;&gt;() &#123;</span><br><span class="line">        &#125;.getType()) &#123;</span><br><span class="line">            public void a(LoginResponse loginResponse) &#123;</span><br><span class="line">                com.mh.movie.core.mvp.ui.b.a(loginResponse.getUserInfo());</span><br><span class="line">                if (loginResponse.getUserInfo().getUserType() == 0) &#123;</span><br><span class="line">                    d.a(SplashPresenter.this.f.getBaseContext(), com.mh.movie.core.mvp.ui.b.i, false);</span><br><span class="line">                &#125;</span><br><span class="line">                com.mh.movie.core.mvp.ui.b.a(SplashPresenter.this.f.getBaseContext(), loginResponse.getUserInfo().getToken());</span><br><span class="line">                com.mh.movie.core.mvp.ui.b.a(SplashPresenter.this.f.getBaseContext(), loginResponse.getUid());</span><br><span class="line">                d.a(SplashPresenter.this.f, com.mh.movie.core.mvp.ui.b.f, XMLUtils.bean2Json(loginResponse.getUserInfo()));</span><br><span class="line">                d.a(SplashPresenter.this.f, com.mh.movie.core.mvp.ui.b.h, loginResponse.getUid());</span><br><span class="line">                com.mh.movie.core.mvp.ui.b.a(loginResponse.getUrlMap());</span><br><span class="line">                com.mh.movie.core.mvp.ui.b.a(true);</span><br><span class="line">                //看下面这一行，就是调用显示广告的额地方，理论上来说直接屏蔽这行就行了，其实仔细分析下，第三个参数，从名字上来看说是要不要加载广告</span><br><span class="line">                ((b) SplashPresenter.this.d).a(loginResponse.getUid(), loginResponse.getAdsList(), loginResponse.isBootadSwitch());</span><br><span class="line">                SplashPresenter.this.f();</span><br><span class="line">                SplashPresenter.this.j();</span><br><span class="line">                SplashPresenter.this.i();</span><br><span class="line">                SplashPresenter.this.k();</span><br><span class="line">            &#125;</span><br><span class="line">            //省略代码</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们尝试修改第三个参数为false。找到loginResponse.isBootadSwitch() 方法，然后让她永远返回false就好了：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">.method</span><span class="keyword"> public</span> isBootadSwitch()Z</span><br><span class="line"><span class="keyword">    .locals</span> 1</span><br><span class="line"></span><br><span class="line"><span class="keyword">    .line</span> 77</span><br><span class="line">    <span class="comment">#iget-boolean v0, p0, Lcom/mh/movie/core/mvp/model/entity/response/LoginResponse;-&gt;bootadSwitch:Z</span></span><br><span class="line">const/4 v0, 0x0</span><br><span class="line">   <span class="built_in"> return </span>v0</span><br><span class="line"><span class="keyword">.end method</span></span><br></pre></td></tr></table></figure>
<p>发现没起作用。。。。</p>
<p>然后我们把尝试下，把 a的调用注释点也即是 下面这行代码，注释掉：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((b) SplashPresenter.this.d).a(loginResponse.getUid(), loginResponse.getAdsList(),</span><br></pre></td></tr></table></figure>
<p>发现还是有闪屏广告，我擦嘞。。。。想一下，那这个地方的广告应该是有缓存，就是在没有网的情况下也可以显示。ok，继续去看 SplashActivity，如果存在这种情况肯定在这个Activity初始化的时候就有了。</p>
<p>继续搜索，this.c </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public void b(@Nullable Bundle bundle) &#123;</span><br><span class="line">    this.k = (TextView) findViewById(R.id.button_enter);</span><br><span class="line">    this.l = (ViewPager) findViewById(R.id.features);</span><br><span class="line">    this.c = (ImageView) findViewById(R.id.splash_bg);</span><br><span class="line">    this.o = (TextView) findViewById(R.id.tv_start);</span><br><span class="line">    this.c.setOnClickListener(this.j);</span><br><span class="line">    com.jakewharton.rxbinding.view.b.a(this.k).a(1, TimeUnit.SECONDS).a(new aw(this));</span><br><span class="line">    //下面的都删了就行</span><br><span class="line">    /*int c = d.c(this, com.mh.movie.core.mvp.ui.b.w);</span><br><span class="line">    e eVar = new e();</span><br><span class="line">    String a = d.a(this, com.mh.movie.core.mvp.ui.b.q);</span><br><span class="line">    if (a != null) &#123;</span><br><span class="line">        this.e = (List) eVar.a(a, new com.google.gson.b.a&lt;List&lt;AdsResponse&gt;&gt;() &#123;</span><br><span class="line">        &#125;.getType());</span><br><span class="line">        this.d = (AdsResponse) this.e.get((c + 1) % this.e.size());</span><br><span class="line">        Glide.with((FragmentActivity) this).load(this.d.getThumbnailUrl()).apply(new RequestOptions().placeholder(R.mipmap.launch_screen)).into(this.c);</span><br><span class="line">    &#125;*/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后把a方法里面的广告加载都删除了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*public void a(long j, List&lt;AdsResponse&gt; list, boolean z) &#123;</span></span><br><span class="line"><span class="comment">     int i = 1;</span></span><br><span class="line"><span class="comment">     this.g = true;</span></span><br><span class="line"><span class="comment">     this.h = z;</span></span><br><span class="line"><span class="comment">     ((SplashPresenter) this.b).e();</span></span><br><span class="line"><span class="comment">     ((SplashPresenter) this.b).g();</span></span><br><span class="line"><span class="comment">     if (!(list == null || list.isEmpty())) &#123;</span></span><br><span class="line"><span class="comment">         int c = d.c(this, com.mh.movie.core.mvp.ui.b.w);</span></span><br><span class="line"><span class="comment">         int i2 = 0;</span></span><br><span class="line"><span class="comment">         if (this.e == null || !((AdsResponse) this.e.get(0)).getThumbnailUrl().equals(((AdsResponse) list.get(0)).getThumbnailUrl())) &#123;</span></span><br><span class="line"><span class="comment">             d.a((Context) this, com.mh.movie.core.mvp.ui.b.q, new e().a((Object) list));</span></span><br><span class="line"><span class="comment">             while (i &lt; list.size()) &#123;</span></span><br><span class="line"><span class="comment">                 if (!TextUtils.isEmpty(((AdsResponse) list.get(i)).getThumbnailUrl())) &#123;</span></span><br><span class="line"><span class="comment">                     Glide.with((FragmentActivity) this).load(((AdsResponse) list.get(i)).getThumbnailUrl()).preload();</span></span><br><span class="line"><span class="comment">                 &#125;</span></span><br><span class="line"><span class="comment">                 i++;</span></span><br><span class="line"><span class="comment">             &#125;</span></span><br><span class="line"><span class="comment">         &#125; else &#123;</span></span><br><span class="line"><span class="comment">             i2 = (c + 1) % list.size();</span></span><br><span class="line"><span class="comment">         &#125;</span></span><br><span class="line"><span class="comment">         d.a((Context) this, com.mh.movie.core.mvp.ui.b.w, i2);</span></span><br><span class="line"><span class="comment">         this.d = (AdsResponse) list.get(i2);</span></span><br><span class="line"><span class="comment">         Glide.with((FragmentActivity) this).load(this.d.getThumbnailUrl()).apply(new RequestOptions().placeholder(this.c.getDrawable())).into(this.c);</span></span><br><span class="line"><span class="comment">         com.mh.movie.core.mvp.ui.b.c = d.b(this.r, "is_first_partner");</span></span><br><span class="line"><span class="comment">     &#125;*/</span></span><br><span class="line">     f();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>总结一下去掉闪屏广告：</p>
<ol>
<li>去掉从缓存里面加载广告</li>
<li>去掉请求广告api成功的显示广告</li>
<li>去掉延迟启动主界面 （MainActivity）</li>
</ol>
<p>好了，世界从此干净了。。。</p>
<p>最后说一点，每次启动到MainActivity都会问我要不要登陆。我不想看到它。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    @Subscriber(tag = &quot;sign_up_success&quot;)</span><br><span class="line">    public void signupSuccess(String str) &#123;</span><br><span class="line">        this.p = &quot;&quot;;</span><br><span class="line">        if (com.mh.movie.core.mvp.ui.b.H &gt; 0) &#123;</span><br><span class="line">            CustomToast.makeTitleText(this.r, &quot;新手奖励&quot;, String.format(&quot;恭喜你获得新会员奖励：%s麻花币，快去看看吧！&quot;, new Object[]&#123;Integer.valueOf(com.mh.movie.core.mvp.ui.b.H)&#125;)).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"> public void f() &#123;</span><br><span class="line">    if (this.d || com.mh.movie.core.mvp.ui.b.H &lt;= 0) &#123;</span><br><span class="line">        g();</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if (this.h == null) &#123;</span><br><span class="line">        this.h = new RequestPermissionDialog(this.r, 3, 2);</span><br><span class="line">        this.h.a(&quot;新手奖励&quot;);</span><br><span class="line">        this.h.b(String.format(&quot;恭喜你获得新会员奖励:%s麻花币，麻花币可以兑换特权和奖品哦！&quot;, new Object[]&#123;Integer.valueOf(com.mh.movie.core.mvp.ui.b.H)&#125;));</span><br><span class="line">        this.h.a(new RequestPermissionDialog.a() &#123;</span><br><span class="line">            public void a() &#123;</span><br><span class="line">                MainActivity.this.h.dismiss();</span><br><span class="line">                MainActivity.this.startActivity(new Intent(MainActivity.this.r, RegistActivity.class));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            public void b() &#123;</span><br><span class="line">                MainActivity.this.h.dismiss();</span><br><span class="line">                MainActivity.this.g();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    this.h.show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>把这个方法注释了。就行了。这篇文章是开始，没啥技术含量~</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://andx.site/2018/12/14/2018-12-14-去掉麻花影视闪屏广告（完成）/" data-id="cjqevh0om003ljl24fu792gbv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/逆向/">逆向</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/麻花影视/">麻花影视</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2018-12-13-麻花影视分析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/13/2018-12-13-麻花影视分析/" class="article-date">
  <time datetime="2018-12-13T06:46:31.000Z" itemprop="datePublished">2018-12-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>►<a class="article-category-link" href="/categories/Android/逆向/">逆向</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/13/2018-12-13-麻花影视分析/">2018-12-13-麻花影视分析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>当前分析版本：V7_2.3.0</p>
<p>Android 移动客户端</p>
<p>这个app里面的资源感觉还不错，而且广告相对来说还是比较少的，就是播放器做的有点丑，而且不支持拖动快进。</p>
<ul>
<li>去掉闪屏广告</li>
<li>分析他的请求API<ul>
<li>解除抓包检测？破解抓包防护</li>
<li>破解返回的加密数据</li>
<li>构建请求头，模拟请求</li>
</ul>
</li>
<li>是否破解金币机制<ul>
<li>是否能刷出无限金币(自动做任务，也就是模拟请求)不现实，金币每天只能奖励一次</li>
</ul>
</li>
<li>破解下载限制<ul>
<li>其实破解了播放也基本就是破解了下载了（其实可以添加边播边下功能）</li>
</ul>
</li>
</ul>
<p>这个系列的文章可以干嘛：</p>
<ul>
<li>如果你想了解如何逆向一个app的基本思路</li>
<li>如果你想了解视频播放相关知识，可以读读</li>
<li>如果你想了解如何对抗逆向</li>
<li>如果你想了解网络抓包的方式</li>
<li>如果你想了解别人的会员机制</li>
</ul>
<p>新人贴对论坛不太了解，版主说我发的太分散了，不利于阅读而且有刷贴的嫌疑，但是我感觉放到一篇里面思路不清晰，所以把文章放到别的地方这里只放链接，大概分为以下几篇：</p>
<ul>
<li><a href="/2018/12/14/2018-12-14-去掉麻花影视闪屏广告（完成）">2018-12-14-去掉麻花影视闪屏广告（完成）</a></li>
<li><a href="/2018/12/15/2018-12-15-分析麻花影视点击视频播放按钮操作（完成）">2018-12-15-分析麻花影视点击视频播放按钮操作（完成）</a></li>
<li><a href="/2018/12/16/2018-12-16-绕过麻花影视抓包检测（完成）">2018-12-16-绕过麻花影视抓包检测（完成）</a></li>
<li><a href="/2018/12/17/2018-12-17-解密麻花影视视频播放地址（完成）">2018-12-17-解密麻花影视视频播放地址（完成）</a></li>
<li><a href="/2018/12/18/2018-12-18-麻花影视模拟发送请求（完成）">2018-12-18-麻花影视模拟发送请求（完成）</a></li>
<li><a href="/2018/12/25/2018-12-25-麻花影视去除热门视频强制分享的要求（完成）">2018-12-25-麻花影视去除热门视频强制分享的要求（完成）</a></li>
<li><a href="/2018/12/27/2018-12-27-麻花影视会员蓝关分析(方案不可行">2018-12-27-麻花影视会员蓝关分析(方案不可行)</a>)</li>
</ul>
<blockquote>
<p>PS: 我的工作是Android安全，我特么不是打包dang，只是关注安卓破解和对抗。只是感觉这个app做的比较好，除了Android 客户端的播放器有点差之外其他都挺好的。而且里面用了很多框架和新的技术。所以想要尝试一下，尝试下这种使用了框架的逆向的成本。顺便学习下他的音视频相关的技术。</p>
</blockquote>
<p>考虑到人家的版权和生存。我在最后只给出Android客户端的去掉闪屏广告和去掉分享才能观看限制的版本的apk，他app里面的广告不予处理。因为启动的这五秒太头疼了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://andx.site/2018/12/13/2018-12-13-麻花影视分析/" data-id="cjqeurshz003bjl24uzg2hor5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/逆向/">逆向</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/麻花影视/">麻花影视</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2018-08-02-Android 上关于设备唯一标识的调研" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/02/2018-08-02-Android 上关于设备唯一标识的调研/" class="article-date">
  <time datetime="2018-08-02T06:46:31.000Z" itemprop="datePublished">2018-08-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/02/2018-08-02-Android 上关于设备唯一标识的调研/">Android 上关于设备唯一标识的调研</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>看看官网怎么说的<a href="https://developer.android.com/training/articles/user-data-ids" target="_blank" rel="noopener">唯一标识符最佳做法</a></p>
<h2 id="一、先来明白几个概念："><a href="#一、先来明白几个概念：" class="headerlink" title="一、先来明白几个概念："></a>一、先来明白几个概念：</h2><p>什么是IMEI？<br>IMEI(International Mobile Equipment Identity)是国际移动设备身份码的缩写，国际移动装备辨识码，是由15位数字组成的”电子串号”，它与每台手机一一对应，而且该码是全世界唯一的。每一部手机在组装完成后都将被赋予一个全球唯一的一组号码，这个号码从生产到交付使用都将被制造生产的厂商所记录。IMEI码由GSM（全球移动通信协会）统一分配，授权BABT（英国通信认证管理委员会）审受。<br>IMEI组成为：<br>1、前6位数（TAC，Type ApprovalCode)是”型号核准号码”，一般代表机型。<br>2、接着的2位数（FAC，Final Assembly Code)是”最后装配号”，一般代表产地。<br>3、之后的6位数（SNR)是”串号”，一般代表生产顺序号。<br>4、最后1位数（SP)通常是”0”，为检验码，备用。</p>
<p>一般在Android手机上可以在关于手机里面查看到</p>
<p><strong>什么是IMSI？</strong><br>国际移动用户识别码（IMSI：International Mobile Subscriber Identification Number）是区别移动用户的标志，储存在SIM卡中，可用于区别移动用户的有效信息。其总长度不超过15位，同样使用0～9的数字。</p>
<p><strong>什么是ICCID？</strong><br>ICCID：Integrate circuit card identity 集成电路卡识别码（固化在手机SIM卡中），简单来说就是SIM卡序列号，它拥有独一无二的特性，类似于手机的序列号，仅仅指向一张手机卡。共有20位数字组成，不同运营商编码格式不一样。并且前六位数字为运营商代码：比如中国移动的为：898600；中国联通的为：898601，中国电信的为：898603。</p>
<blockquote>
<p>简而言之：IMEI / MEID 是和设备相关的，移动设备的唯一标志码；而IMSI 和 ICCID 是和手机卡相关的，信息存储到手机卡上，没有安装手机卡的手机，上面获取这两个值为null。</p>
</blockquote>
<h2 id="二、TelephonyManager-相关"><a href="#二、TelephonyManager-相关" class="headerlink" title="二、TelephonyManager 相关"></a>二、TelephonyManager 相关</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//注意代码使用需要在Manifest配置权限</span><br><span class="line">// &lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot; /&gt; </span><br><span class="line">//在API 23（Android6.0 ）及其以上版本phone组权限需要动态申请</span><br><span class="line">TelephonyManager tm = (TelephonyManager) this.getSystemService(Context.TELEPHONY_SERVICE);  </span><br><span class="line">String deviceid = tm.getDeviceId();   //取 IMEI或者MEID</span><br><span class="line">String tel = tm.getLine1Number();     //取出用户手机号码,手机没有安装SIM卡，值为null</span><br><span class="line">String imsi =tm.getSubscriberId();     //取出IMSI,手机没有安装SIM卡，值为null</span><br><span class="line">String imei =tm.getSimSerialNumber();  //取出ICCID,手机没有安装SIM卡，值为null</span><br></pre></td></tr></table></figure>
<p>其实上面的信息分开来看总共分为两部分，一部分是设备相关的信息，一部分是SIM卡相关的信息。关于SIM卡相关的信息，一般来说没有办法标志设备，因为手机可以任意替换SIM卡，而且现在手机都是双卡双待的，关于双卡手机获取和手机卡相关的信息参考<a href="https://www.jianshu.com/p/1269e4ba99c9" target="_blank" rel="noopener">这篇文章</a></p>
<p>我们这里主要关心设备ID（IMEI或者MEID），解释下这两个东西：IMEI是国际移动设备识别码的简称，而MEID是 动设备识别码的简称，一般IMEI是所有设备都有，而MEID一般只在只有支持CDMA制式的设备才有的。</p>
<p>OPPO 手机：进入手机设置–常规–关于手机–状态信息–IMEI即可看到。<br>小米手机： 设置–我的设备–全部参数–状态信息—IMEI信息<br>华为手机：设置—关于手机</p>
<blockquote>
<p>注意：平板没有imei号</p>
</blockquote>
<h2 id="三、设备唯一ID"><a href="#三、设备唯一ID" class="headerlink" title="三、设备唯一ID"></a>三、设备唯一ID</h2><h3 id="1-IMEI或者MEID"><a href="#1-IMEI或者MEID" class="headerlink" title="1. IMEI或者MEID"></a>1. IMEI或者MEID</h3><blockquote>
<p>Android系统关于双卡的支持的知识需要知道一些，在Android4.x及其以下版本的时候，原生Android是不支持双卡的，在5.x左右开始支持，但是api是隐藏的，在Android 6.0 才开始公开开放双卡的API。</p>
</blockquote>
<p>来看下我们获取IMEI或者MEID的基本方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//注意动态权限申请</span><br><span class="line">TelephonyManager telephonyManager = (TelephonyManager) this.getSystemService(Context.TELEPHONY_SERVICE);</span><br><span class="line">String imei = telephonyManager.getDeviceId();</span><br></pre></td></tr></table></figure></p>
<p>这个方法在4.x及其以下版本的时候，运行这个方法是没有问题的，因为4.x是不支持双卡的，也就是说4.x的手机要么是GSM要么是CDMA制式的。所以，<code>getDeviceId</code>的文档这样写道：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Returns the unique device ID, for example, the IMEI for GSM and the MEID</span><br><span class="line"> * or ESN for CDMA phones. Return null if device ID is not available.</span><br><span class="line"> * 翻译过来就是：这个方法会返回唯一的设备id，</span><br><span class="line"> * 比如在GSM的手机上返回的是IMEI，而在CDMA 手机上返回的是MEID或者ESN。</span><br><span class="line"> * 如果设备id不可读取，那么返回null。</span><br><span class="line"> */</span><br></pre></td></tr></table></figure></p>
<p>但是这种情况到了Android 6.0 （先不考虑5.x 那个版本不稳定）上就不一样了，6.0支持双卡，也就是说手机上不可以能只有一个IMEI或者MEID，这个时候就需要根据手机卡槽获取了，这个卡槽里面装的是什么制式的卡，那么对于下标获取的就是IMEI或者MEID：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public void onClick(View view) &#123;</span><br><span class="line"></span><br><span class="line">    TelephonyManager tm = (TelephonyManager) this.getSystemService(Context.TELEPHONY_SERVICE);</span><br><span class="line">    </span><br><span class="line">    Log.d(&quot;Q_M&quot;, &quot;meid：&quot; + tm.getDeviceId());</span><br><span class="line">    Log.d(&quot;Q_M&quot;, &quot;meid：&quot; + tm.getDeviceId(0));</span><br><span class="line">    Log.d(&quot;Q_M&quot;, &quot;meid：&quot; + tm.getDeviceId(1));</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试结果来自网络，我没有验证（我对不插卡的情况存在疑问）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">我的两张联通卡分别获取的是imei1和imei2</span><br><span class="line"></span><br><span class="line">    1、不插卡（或两张卡都是GSM卡）</span><br><span class="line"></span><br><span class="line">      getDeviceId()  返回 imei1</span><br><span class="line">      getDeviceId(0) 返回 imei1</span><br><span class="line">      getDeviceId(1) 返回 imei2</span><br><span class="line"></span><br><span class="line">      2、卡1插CDMA卡，卡2不插卡（或卡2插GSM卡）</span><br><span class="line"></span><br><span class="line">      getDeviceId()   返回 meid</span><br><span class="line">      getDeviceId(0) 返回 meid</span><br><span class="line">      getDeviceId(1) 返回 imei2</span><br><span class="line"></span><br><span class="line">      3、卡1不插卡（或卡1插GSM卡）卡2插CDMA卡</span><br><span class="line"></span><br><span class="line">      getDeviceId()   返回 imei1</span><br><span class="line">      getDeviceId(0) 返回 imei1</span><br><span class="line">      getDeviceId(1) 返回 meid</span><br></pre></td></tr></table></figure></p>
<p>后来到了Android 8.0 ，方法控制更为精细了，所以这个getDeviceId 方法就被废弃了，不再推荐使用。而推荐使用 <code>getImei</code>和<code>getMeid</code> 同时这两个方法支持传入卡槽的下标来确定要读取那个卡对应的值。在8.0 及其以上的手机上可以这么严重：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public void onClick(View view) &#123;</span><br><span class="line"></span><br><span class="line">    TelephonyManager tm = (TelephonyManager) this.getSystemService(Context.TELEPHONY_SERVICE);</span><br><span class="line"></span><br><span class="line">    //手机上存在两个imei值，分配给两个卡槽</span><br><span class="line">    Log.d(&quot;Q_M&quot;, &quot;imei：&quot; + tm.getImei());</span><br><span class="line">    Log.d(&quot;Q_M&quot;, &quot;imei0：&quot; + tm.getImei(0));</span><br><span class="line">    Log.d(&quot;Q_M&quot;, &quot;imei1：&quot; + tm.getImei(1));</span><br><span class="line">    </span><br><span class="line">    //手机上只会存在一个meid,两个卡槽获取的一样</span><br><span class="line">    Log.d(&quot;Q_M&quot;, &quot;meid：&quot; + tm.getMeid());</span><br><span class="line">    Log.d(&quot;Q_M&quot;, &quot;meid0：&quot; + tm.getMeid(0));</span><br><span class="line">    Log.d(&quot;Q_M&quot;, &quot;meid1：&quot; + tm.getMeid(1));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后来看一眼友盟的代码里面获取 Imei 的方式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">public static String getImeiNew(Context var0) &#123;</span><br><span class="line">    String var1 = null;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        if(var0 != null) &#123;</span><br><span class="line">            TelephonyManager var2 = (TelephonyManager)var0.getSystemService(&quot;phone&quot;);</span><br><span class="line">            if(var2 != null &amp;&amp; checkPermission(var0, &quot;android.permission.READ_PHONE_STATE&quot;)) &#123;</span><br><span class="line">                if(VERSION.SDK_INT &gt;= 26) &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        Method var3 = var2.getClass().getMethod(&quot;getImei&quot;, new Class[0]);</span><br><span class="line">                        var3.setAccessible(true);</span><br><span class="line">                        var1 = (String)var3.invoke(var2, new Object[0]);</span><br><span class="line">                    &#125; catch (Exception var4) &#123;</span><br><span class="line">                        ;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    if(TextUtils.isEmpty(var1)) &#123;</span><br><span class="line">                        var1 = var2.getDeviceId();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    var1 = var2.getDeviceId();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (Exception var5) &#123;</span><br><span class="line">        if(AnalyticsConstants.UM_DEBUG) &#123;</span><br><span class="line">            MLog.w(&quot;No IMEI.&quot;, var5);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return var1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="2-ANDROIDID"><a href="#2-ANDROIDID" class="headerlink" title="2. ANDROIDID"></a>2. ANDROIDID</h3><p>在设备首次启动时，系统会随机生成一个64位的数字，并把这个数字以16进制字符串的形式保存下来，这个16进制的字符串就是ANDROID_ID，当设备被wipe后该值会被重置。设备恢复出厂设置，这个值也会改变。如果设备被root，这个值可以任意改变。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String androidID = Settings.Secure.getString(context.getContentResolver(), Settings.Secure.ANDROID_ID);</span><br></pre></td></tr></table></figure></p>
<h3 id="3-Serial-Number-设备序列号"><a href="#3-Serial-Number-设备序列号" class="headerlink" title="3. Serial Number (设备序列号)"></a>3. Serial Number (设备序列号)</h3><p>这个东西理论上来说是来自硬件，出厂是就设置好了，但是有些设备厂商会随便写一个值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> Build.SERIAL</span><br><span class="line">在 api&gt;=26的时候</span><br><span class="line">可以这么获取 Build.getSerial();</span><br></pre></td></tr></table></figure>
<h3 id="4-Mac地址"><a href="#4-Mac地址" class="headerlink" title="4. Mac地址"></a>4. Mac地址</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--访问WIFI的权限--&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>Mac地址，在6.0以上不能按正常方式获取，7.0以上很难获取，并且Mac地址也不一定唯一。</p>
<ol>
<li><p><strong>在6.0 以下后去mac地址方式</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WifiManager wifi = (WifiManager) context.getSystemService(Context.WIFI_SERVICE);</span><br><span class="line">WifiInfo winfo = wifi.getConnectionInfo();</span><br><span class="line">String mac =  winfo.getMacAddress();</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在6.0 及其以上8.0以下</strong><br>上面的方法在7.0 的设备获取的永远是<code>02:00:00:00:00:00</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 通过网络接口取</span><br><span class="line"> * 记得添加网络权限</span><br><span class="line"> * &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</span><br><span class="line"> *</span><br><span class="line"> * @return mac 地址字符串</span><br><span class="line"> */</span><br><span class="line">private static String getNewMac() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        List&lt;NetworkInterface&gt; all = Collections.list(NetworkInterface.getNetworkInterfaces());</span><br><span class="line">        for (NetworkInterface nif : all) &#123;</span><br><span class="line">            if (!nif.getName().equalsIgnoreCase(&quot;wlan0&quot;)) continue;</span><br><span class="line"></span><br><span class="line">            byte[] macBytes = nif.getHardwareAddress();</span><br><span class="line">            if (macBytes == null) &#123;</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            StringBuilder res1 = new StringBuilder();</span><br><span class="line">            for (byte b : macBytes) &#123;</span><br><span class="line">                res1.append(String.format(&quot;%02X:&quot;, b));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (res1.length() &gt; 0) &#123;</span><br><span class="line">                res1.deleteCharAt(res1.length() - 1);</span><br><span class="line">            &#125;</span><br><span class="line">            return res1.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (Exception ex) &#123;</span><br><span class="line">        ex.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>注：通过adb命令行可以查看手机mac地址，不过需要root手机：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">命令行</span><br><span class="line">$ adb shell </span><br><span class="line">$ su </span><br><span class="line">$ cat /sys/class/net/wlan0/address</span><br></pre></td></tr></table></figure></p>
<p>【参考文章】<br><a href="http://www.cnblogs.com/sfbrzkh/p/5165873.html" target="_blank" rel="noopener">http://www.cnblogs.com/sfbrzkh/p/5165873.html</a><br><a href="https://developer.android.com/training/articles/user-data-ids" target="_blank" rel="noopener">https://developer.android.com/training/articles/user-data-ids</a><br><a href="https://blog.csdn.net/yangbin0513/article/details/68490291" target="_blank" rel="noopener">https://blog.csdn.net/yangbin0513/article/details/68490291</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://andx.site/2018/08/02/2018-08-02-Android 上关于设备唯一标识的调研/" data-id="cjqeui6690001jl24zfbywef3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2018-07-10-Mac 配置PHP环境" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/10/2018-07-10-Mac 配置PHP环境/" class="article-date">
  <time datetime="2018-07-10T06:46:31.000Z" itemprop="datePublished">2018-07-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PHP/">PHP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/10/2018-07-10-Mac 配置PHP环境/">Mac 配置PHP环境</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="00-开发环境"><a href="#00-开发环境" class="headerlink" title="00 开发环境"></a>00 开发环境</h2><p>Mac 10.13.5</p>
<h2 id="一、启动Apache服务器"><a href="#一、启动Apache服务器" class="headerlink" title="一、启动Apache服务器"></a>一、启动Apache服务器</h2><p>一般来说Mac自带Apache服务器，然后我们通过命令行启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Apache的常用的几个命令</span><br><span class="line">// 启动Apache服务</span><br><span class="line">sudo apachectl start</span><br><span class="line">// 重启Apache服务</span><br><span class="line">sudo apachectl restart</span><br><span class="line">// 停止Apache服务</span><br><span class="line">sudo apachectl stop</span><br><span class="line">// 查看Apache版本</span><br><span class="line">httpd -v</span><br></pre></td></tr></table></figure></p>
<p>打开浏览器，在地址栏中输入<code>localhost</code>，出现<code>It works!</code>字符串，就说明Apache已经成功启动。</p>
<p>修改Apache 的工作目录，因为原来的工作目录再系统目录下，不方便操作：<br><code>$ sudo vim /etc/apache2/httpd.conf</code><br>输入密码后修改两个地方,把 DocumentRoot 和 Directory 配置成自己创建PHP项目的父目录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#DocumentRoot &quot;/Library/WebServer/Documents&quot;</span><br><span class="line">#&lt;Directory &quot;/Library/WebServer/Documents&quot;&gt;</span><br><span class="line">DocumentRoot &quot;/Users/liuqiang/Workspace/php&quot;</span><br><span class="line">&lt;Directory &quot;/Users/liuqiang/Workspace/php&quot;&gt;</span><br></pre></td></tr></table></figure></p>
<p>修改好后:wq保存退出，重启服务器，并在自定义的路径下放置html文件，即可访问。</p>
<h2 id="二、-配置PHP环境变量"><a href="#二、-配置PHP环境变量" class="headerlink" title="二、 配置PHP环境变量"></a>二、 配置PHP环境变量</h2><p>查看PHP是否按照<br><code>$ php -v</code><br>运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PHP 7.1.16 (cli) (built: Apr  1 2018 13:14:42) ( NTS )</span><br><span class="line">Copyright (c) 1997-2018 The PHP Group</span><br><span class="line">Zend Engine v3.1.0, Copyright (c) 1998-2018 Zend Technologies</span><br></pre></td></tr></table></figure></p>
<p>然后修改PHP配置文件</p>
<p><code>$ sudo vim /etc/apache2/httpd.conf</code></p>
<p>修改如下配置：<br>去掉下面这行的注释(把签名的# 去掉)<br><code>LoadModule php7_module libexec/apache2/libphp7.so</code></p>
<p>修改好后:wq保存退出。</p>
<blockquote>
<p>注意：mac更新的时候，这一行有可能会被重新注释掉</p>
</blockquote>
<h2 id="三、-添加-xdebug-断点调试工具"><a href="#三、-添加-xdebug-断点调试工具" class="headerlink" title="三、 添加 xdebug 断点调试工具"></a>三、 添加 <a href="https://xdebug.org/wizard.php" target="_blank" rel="noopener">xdebug</a> 断点调试工具</h2><p>这个工具的安装比较有意思，调试工具必须要适配PHP版本，所以要把PHP的信息粘贴到xdebug官网的一个<a href="https://xdebug.org/wizard.php" target="_blank" rel="noopener">工具</a>里面然后会有步骤告诉你该如何安装。</p>
<p>访问<a href="https://xdebug.org/wizard.php" target="_blank" rel="noopener">https://xdebug.org/wizard.php</a>，然后上面有说明输入框改填写啥，最简单的是控制台运行<code>php -i</code> 然后把输出粘贴到输入框里面，然后点击<code>Analyse my phpinfo() output</code>按钮就行了。里面又详细的安装步骤。这里记录一下安装中遇到错误</p>
<ol>
<li>错误一：<br>运行 <code>phpize</code> 报错：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">liuqiangs-MBP:xdebug-2.6.0 liuqiang$ phpize</span><br><span class="line">grep: /usr/include/php/main/php.h: No such file or directory</span><br><span class="line">grep: /usr/include/php/Zend/zend_modules.h: No such file or directory</span><br><span class="line">grep: /usr/include/php/Zend/zend_extensions.h: No such file or directory</span><br><span class="line">Configuring for:</span><br><span class="line">PHP Api Version:</span><br><span class="line">Zend Module Api No:</span><br><span class="line">Zend Extension Api No:</span><br><span class="line">Cannot find autoconf. Please check your autoconf installation and the</span><br><span class="line">$PHP_AUTOCONF environment variable. Then, rerun this script.</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>首先这是两个错误，一个是 <a href="https://stackoverflow.com/questions/31583646/cannot-find-autoconf-please-check-your-autoconf-installation-xampp-in-centos" target="_blank" rel="noopener">autoconf 这个玩意没有安装</a>，安装方法:</p>
<p><code>$ brew install autoconf</code></p>
<p>第二个是那些 <code>No such file or directory</code> 的错误，是因为有些配置没有配置好，安装xcode 可以帮你自动配置，安装方法：</p>
<p><code>$ xcode-select --install</code></p>
<blockquote>
<p>最后注意，如果想要用PHPStorm 调试的话，要在 /etc/php.ini 里面开启远程调试功能</p>
</blockquote>
<p>添加如下配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xdebug.remote_enable=1</span><br><span class="line">xdebug.remote_port=9000</span><br><span class="line">xdebug.profiler_enable=1</span><br><span class="line">xdebug.idekey = PHPStorm</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://andx.site/2018/07/10/2018-07-10-Mac 配置PHP环境/" data-id="cjqeui6650000jl24swxxigpe" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/">PHP</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/AndroidStudio/">AndroidStudio</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Chrome插件/">Chrome插件</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/IPC/">IPC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/MPAndroidChart/">MPAndroidChart</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Notification/">Notification</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Smali/">Smali</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/ValueAnimator/">ValueAnimator</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/adb/">adb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/ndk/">ndk</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/ndk/jni/">jni</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/动画/">动画</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/文件存储/">文件存储</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/编译/">编译</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/逆向/">逆向</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/AndroidStudio/">AndroidStudio</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/AndroidStudio/Android/">Android</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/">Blog</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/WorPress/">WorPress</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Django/">Django</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/Web/">Web</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hadoop/">Hadoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/搜索/">搜索</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hive/">Hive</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/Android/面试/">面试</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/加密/">加密</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/算法/">算法</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/压缩/">压缩</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/压缩/Zip/">Zip</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/命令行/">命令行</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/其他/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/命令行/">命令行</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/SQL/">SQL</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nodejs/">Nodejs</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Nodejs/npm/">npm</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PhotoShop/">PhotoShop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PostGreSQL/">PostGreSQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Python/Django/">Django</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL/">SQL</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/SQL/工具/">工具</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Sublime/">Sublime</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Sublime/工具/">工具</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/blog/Jekyll/">Jekyll</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/postgres/">postgres</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/个人想法/">个人想法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/其他/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/加密/">加密</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/加密/协议/">协议</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/周易/">周易</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/编码/">编码</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络/">网络</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AndroidStudio/">AndroidStudio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Binder/">Binder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Blog/">Blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chrome插件/">Chrome插件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/">Django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/">Gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gson/">Gson</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hadoop/">Hadoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hive/">Hive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IPC/">IPC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jekyll/">Jekyll</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MPAndroidChart/">MPAndroidChart</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac/">Mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/">Nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Notification/">Notification</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PS笔记/">PS笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PhotoShop/">PhotoShop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostGreSQL/">PostGreSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Proguard/">Proguard</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/">SQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Smali/">Smali</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sublime/">Sublime</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ValueAnimator/">ValueAnimator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ViewPager/">ViewPager</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WorPress/">WorPress</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zip/">Zip</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/adb/">adb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jni/">jni</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ndk/">ndk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgres/">postgres</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/个人想法/">个人想法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/其他/">其他</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/加密/">加密</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/动画/">动画</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/协议/">协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/压缩/">压缩</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/周易/">周易</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/命令行/">命令行</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/大数据/">大数据</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具/">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/快捷键/">快捷键</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/打包/">打包</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件存储/">文件存储</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/泛型/">泛型</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/源码/">源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/站内搜索/">站内搜索</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编码/">编码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编译/">编译</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络/">网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/解密/">解密</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/逆向/">逆向</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试/">面试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/麻花影视/">麻花影视</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/AndroidStudio/" style="font-size: 15.56px;">AndroidStudio</a> <a href="/tags/Binder/" style="font-size: 11.11px;">Binder</a> <a href="/tags/Blog/" style="font-size: 11.11px;">Blog</a> <a href="/tags/Chrome插件/" style="font-size: 10px;">Chrome插件</a> <a href="/tags/Django/" style="font-size: 11.11px;">Django</a> <a href="/tags/Git/" style="font-size: 13.33px;">Git</a> <a href="/tags/Gradle/" style="font-size: 10px;">Gradle</a> <a href="/tags/Gson/" style="font-size: 10px;">Gson</a> <a href="/tags/Hadoop/" style="font-size: 10px;">Hadoop</a> <a href="/tags/Hexo/" style="font-size: 11.11px;">Hexo</a> <a href="/tags/Hive/" style="font-size: 10px;">Hive</a> <a href="/tags/IPC/" style="font-size: 11.11px;">IPC</a> <a href="/tags/Java/" style="font-size: 18.89px;">Java</a> <a href="/tags/Jekyll/" style="font-size: 10px;">Jekyll</a> <a href="/tags/Linux/" style="font-size: 12.22px;">Linux</a> <a href="/tags/MPAndroidChart/" style="font-size: 10px;">MPAndroidChart</a> <a href="/tags/Mac/" style="font-size: 13.33px;">Mac</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Nodejs/" style="font-size: 12.22px;">Nodejs</a> <a href="/tags/Notification/" style="font-size: 10px;">Notification</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/PS笔记/" style="font-size: 12.22px;">PS笔记</a> <a href="/tags/PhotoShop/" style="font-size: 12.22px;">PhotoShop</a> <a href="/tags/PostGreSQL/" style="font-size: 13.33px;">PostGreSQL</a> <a href="/tags/Proguard/" style="font-size: 10px;">Proguard</a> <a href="/tags/Python/" style="font-size: 16.67px;">Python</a> <a href="/tags/SQL/" style="font-size: 11.11px;">SQL</a> <a href="/tags/Smali/" style="font-size: 10px;">Smali</a> <a href="/tags/Sublime/" style="font-size: 11.11px;">Sublime</a> <a href="/tags/ValueAnimator/" style="font-size: 10px;">ValueAnimator</a> <a href="/tags/ViewPager/" style="font-size: 10px;">ViewPager</a> <a href="/tags/WorPress/" style="font-size: 10px;">WorPress</a> <a href="/tags/Zip/" style="font-size: 10px;">Zip</a> <a href="/tags/adb/" style="font-size: 10px;">adb</a> <a href="/tags/jni/" style="font-size: 10px;">jni</a> <a href="/tags/ndk/" style="font-size: 10px;">ndk</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/postgres/" style="font-size: 10px;">postgres</a> <a href="/tags/个人想法/" style="font-size: 10px;">个人想法</a> <a href="/tags/其他/" style="font-size: 11.11px;">其他</a> <a href="/tags/加密/" style="font-size: 13.33px;">加密</a> <a href="/tags/动画/" style="font-size: 10px;">动画</a> <a href="/tags/协议/" style="font-size: 10px;">协议</a> <a href="/tags/压缩/" style="font-size: 10px;">压缩</a> <a href="/tags/周易/" style="font-size: 10px;">周易</a> <a href="/tags/命令行/" style="font-size: 11.11px;">命令行</a> <a href="/tags/大数据/" style="font-size: 10px;">大数据</a> <a href="/tags/工具/" style="font-size: 12.22px;">工具</a> <a href="/tags/快捷键/" style="font-size: 10px;">快捷键</a> <a href="/tags/打包/" style="font-size: 10px;">打包</a> <a href="/tags/数据库/" style="font-size: 10px;">数据库</a> <a href="/tags/文件存储/" style="font-size: 10px;">文件存储</a> <a href="/tags/泛型/" style="font-size: 10px;">泛型</a> <a href="/tags/源码/" style="font-size: 10px;">源码</a> <a href="/tags/站内搜索/" style="font-size: 10px;">站内搜索</a> <a href="/tags/算法/" style="font-size: 14.44px;">算法</a> <a href="/tags/编码/" style="font-size: 10px;">编码</a> <a href="/tags/编译/" style="font-size: 12.22px;">编译</a> <a href="/tags/网络/" style="font-size: 10px;">网络</a> <a href="/tags/解密/" style="font-size: 10px;">解密</a> <a href="/tags/逆向/" style="font-size: 17.78px;">逆向</a> <a href="/tags/面试/" style="font-size: 13.33px;">面试</a> <a href="/tags/麻花影视/" style="font-size: 16.67px;">麻花影视</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/12/27/2018-12-27-麻花影视会员蓝关分析（方案不可行）/">2018-12-27-麻花影视会员蓝关分析（方案不可行）</a>
          </li>
        
          <li>
            <a href="/2018/12/25/2018-12-25-麻花影视去除热门视频强制分享的要求（完成）/">2018-12-25-麻花影视去除热门视频强制分享的要求（完成）</a>
          </li>
        
          <li>
            <a href="/2018/12/18/2018-12-18-麻花影视模拟发送请求（完成）/">2018-12-18-麻花影视模拟发送请求（完成）</a>
          </li>
        
          <li>
            <a href="/2018/12/17/2018-12-17-解密麻花影视视频播放地址（完成）/">2018-12-17-解密麻花影视视频播放地址（完成）</a>
          </li>
        
          <li>
            <a href="/2018/12/16/2018-12-16-绕过麻花影视抓包检测（完成）/">2018-12-16-绕过麻花影视抓包检测（完成）</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 QX<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>