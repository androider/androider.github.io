<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Android属性动画之ValueAnimator · 奋斗の小鸟</title><meta name="description" content="Android属性动画之ValueAnimator - Qiang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><!-- fonts--><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="http://fonts.lug.ustc.edu.cn/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><input type="checkbox" id="sidebar-toggle"><aside><div class="author"><a href="/."><img src="/img/author.png" class="author-img"></a><h2 class="author-name">Qiang</h2></div><div class="post-toc"><span class="toc-title">Directory</span><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一个对ListView做伸缩的例子"><span class="toc-text">一个对ListView做伸缩的例子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#原理解释"><span class="toc-text">原理解释</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在Property-Animation中，可以对动画应用以下属性："><span class="toc-text">在Property Animation中，可以对动画应用以下属性：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Interpolator"><span class="toc-text">Interpolator</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TypeEvaluator"><span class="toc-text">TypeEvaluator</span></a></li></ol></div></aside><div class="main"><header><div id="top"><a href="/." class="logo-link">奋斗の小鸟</a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">首页</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">标签</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">关于</a></li><li class="nav-list-item"><a href="/search.html" target="_self" class="nav-list-link">搜索</a></li></ul></div></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Android属性动画之ValueAnimator</h1><div class="post-time">Aug 28, 2015</div><div class="post-content"><h2 id="一个对ListView做伸缩的例子"><a href="#一个对ListView做伸缩的例子" class="headerlink" title="一个对ListView做伸缩的例子"></a>一个对ListView做伸缩的例子</h2><p>用ValueAnimator来实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 隐藏或显示ListView的动画</div><div class="line"> *  参数分别为ListView的其实高度和最终高度</div><div class="line"> *  这种写法有缺陷，繁琐了</div><div class="line"> */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hideOrShowListViewAnimator</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> startValue,<span class="keyword">final</span> <span class="keyword">int</span> endValue)</span></span>&#123;</div><div class="line"></div><div class="line">		<span class="comment">//1.设置属性的初始值和结束值</span></div><div class="line"></div><div class="line">		ValueAnimator mAnimator = ValueAnimator.ofInt(<span class="number">0</span>,<span class="number">100</span>);</div><div class="line"></div><div class="line">		<span class="comment">//2.为目标对象的属性变化设置监听器</span></div><div class="line"></div><div class="line">                <span class="comment">//(每个时间片调用一次   调用次数=setDuration的时常/时间片（系统每隔多长时间执行一次）)</span></div><div class="line"></div><div class="line">		mAnimator.addUpdateListener(<span class="keyword">new</span> AnimatorUpdateListener() &#123;</div><div class="line"></div><div class="line">			<span class="meta">@Override</span></div><div class="line"></div><div class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</div><div class="line"></div><div class="line">				<span class="comment">// TODO Auto-generated method stub</span></div><div class="line"></div><div class="line">				<span class="keyword">int</span> animatorValue = (<span class="keyword">int</span>)animation.getAnimatedValue();</div><div class="line"></div><div class="line">				<span class="keyword">float</span> fraction = animatorValue/<span class="number">100f</span>;</div><div class="line"></div><div class="line">				IntEvaluator mEvaluator = <span class="keyword">new</span> IntEvaluator();</div><div class="line"></div><div class="line">				<span class="comment">//3.使用IntEvaluator计算属性值并赋值给ListView的高</span></div><div class="line"></div><div class="line">				mListView.getLayoutParams().height = mEvaluator.evaluate(fraction, startValue, endValue);</div><div class="line"></div><div class="line">				mListView.requestLayout();</div><div class="line"></div><div class="line">			&#125;</div><div class="line"></div><div class="line">		&#125;);</div><div class="line"></div><div class="line">		<span class="comment">//4.为ValueAnimator设置LinearInterpolator</span></div><div class="line"></div><div class="line">		mAnimator.setInterpolator(<span class="keyword">new</span> LinearInterpolator());</div><div class="line"></div><div class="line">		<span class="comment">//5.设置动画的持续时间</span></div><div class="line"></div><div class="line">		mAnimator.setDuration(<span class="number">500</span>);</div><div class="line"></div><div class="line">		<span class="comment">//6.为ValueAnimator设置目标对象并开始执行动画</span></div><div class="line"></div><div class="line">		mAnimator.setTarget(mListView);</div><div class="line"></div><div class="line">		mAnimator.start();</div><div class="line"></div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>上面代码列表中，需传递的两个参数分别为属性值的初始值和结束值，当需要显示ListView时，传入0和800像素值，当需要隐藏ListView时，传入800和0像素值，ListView的初始化高度默认是0。</p>
<h2 id="原理解释"><a href="#原理解释" class="headerlink" title="原理解释"></a>原理解释</h2><p>其实ValueAnimator叫做动画，他其实并不是我们视觉上的动画，他是对某个范围的值做动画。</p>
<p>例如：</p>
<p><code>ValueAnimator mAnimator = ValueAnimator.ofInt(0,100);</code></p>
<p><code>mAnimator.setDuration(500);</code></p>
<p>其实在默认的差值器的情况下，ValueAnimator是把0-100的数在500毫秒内数完。也就是说500ms内执行了100次，</p>
<p>每5ms执行一次。没执行一次调用一次AnimatorUpdateListener接口的回调方法。</p>
<h3 id="在Property-Animation中，可以对动画应用以下属性："><a href="#在Property-Animation中，可以对动画应用以下属性：" class="headerlink" title="在Property Animation中，可以对动画应用以下属性："></a>在Property Animation中，可以对动画应用以下属性：</h3><p>1）Duration：动画的持续时间</p>
<p>2）TimeInterpolation：Interpolator 时间插值类，定义动画变换的速度。属性的计算方式，如先快后慢，计算后得到（fraction）</p>
<p>3）TypeEvaluator：根据属性的开始值、结束值与【TimeInterpolation计算出的因子（fraction）】计算出当前时间的属性值【开始值&lt;=当前值&lt;=结束值】</p>
<p>4）Repeat Country and behavoir:重复次数与方式，如播放3次，5次，无限循环，可以此动画一直重复，或者播放完时再反向播放。</p>
<p>5) Animation sets:动画集合，即可以同时对一个对象应用几个动画，这些动画可以同时播放也可以对不同的动画设置不同开始偏移</p>
<p>6）Frame refreash delay:多少时间刷新一次，即每隔多少时间计算一次属性值，默认为10ms，最终的刷新时间，还受到系统进程调度与硬件的影响。</p>
<h2 id="Interpolator"><a href="#Interpolator" class="headerlink" title="Interpolator"></a>Interpolator</h2><p><strong>作用：</strong>根据时间流逝的百分比计算出当前属性值改变的百分比。</p>
<p>插值器它定义了动画变化过程中的属性变化规则，它根据时间比例因子计算出一个插值因子，用于设定目标对象的动画执行是否为线性变化、非线性变化或先加速后减速等等.</p>
<p>其实说白了就是上面提到的数数的快慢的变化的一个数值。上面说的在500ms内执行了100次，这一百次是匀速执行的，也就是没隔5ms执行一次，叫做线性变化，</p>
<p>也就是线性差值器。其实差值器类似于物理中的加速度。</p>
<p><strong>如下为系统定义的差值器：</strong></p>
<ul>
<li>AccelerateDecelerateInterpolator：先加速再减速。</li>
<li>AccelerateInterpolator：一直加速。</li>
<li>AnticipateInterpolator：先往后一下，再嗖的一声一往无前。</li>
<li>AnticipateOvershootInterpolator：先往后一下，再一直往前超过终点，再往回收一下。</li>
<li>BounceInterpolator：最后像个小球弹几下。</li>
<li>CycleInterpolator：重复几次，感觉就是环形进度条那种，具体我还没试过。</li>
<li>DecelerateInterpolator：一直减速。</li>
<li>LinearInterpolator：线性，这个就是我们上面讲到的很均匀的了。</li>
<li>OvershootInterpolator：到了终点之后，超过一点，再往回走。有个参数可以定义，超过的力度。</li>
</ul>
<p>可以自己定义差值器：</p>
<p>继承TimeInterpolator类，重写getInterpolation(float input)方法，并在该方法通过相关的计算，再返回计算后的结果(插值因子)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterpolator</span> <span class="keyword">implements</span> <span class="title">TimeInterpolator</span> </span>&#123;  </div><div class="line"></div><div class="line">    <span class="meta">@Override</span>  </div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getInterpolation</span><span class="params">(<span class="keyword">float</span> input)</span> </span>&#123;  </div><div class="line"></div><div class="line">        <span class="comment">// 编写相关的逻辑计算  </span></div><div class="line"></div><div class="line">        <span class="keyword">return</span> input * input;  </div><div class="line"></div><div class="line">    &#125;  </div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="TypeEvaluator"><a href="#TypeEvaluator" class="headerlink" title="TypeEvaluator"></a>TypeEvaluator</h2><p><strong>作用：</strong>根据当前属性改变的百分比来计算改变后的属性值。</p>
<p>大多数时候，我们是在自定义这个东西。一般来说系统预留的差值器，就够用了。</p>
<p><strong>系统定义的估值器</strong></p>
<ul>
<li>IntEvaluator：针对整型属性 </li>
<li>FloatEvaluator：针对浮点型属性 </li>
<li>ArgbEvaluator：针对Color属性</li>
</ul>
<p>例如FloatEvaluator的源码为:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FloatEvaluator</span> <span class="keyword">implements</span> <span class="title">TypeEvaluator</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//fraction  差值器计算出来的一个小数值，也即是属性要变化的百分比</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">evaluate</span><span class="params">(<span class="keyword">float</span> fraction, Object startValue, Object endValue)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">float</span> startFloat = ((Number) startValue).floatValue();</div><div class="line"></div><div class="line">        <span class="keyword">return</span> startFloat + fraction * (((Number) endValue).floatValue() - startFloat);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>PS总结：</p>
<p>从用户看来，界面的变化率是根据差值器变化的，其实，代码调用界面重绘的频率是一定的</p>
<p>比如：没10ms调用一次界面重绘，但是每次重绘的时候值的变化是不同的。</p>
<p>比如，修改View的位移变化。使用DecelerateInterpolator差值器，动画导致View刷新屏幕界面，</p>
<p>这个调用代码的频率是一样的，为了体现先快后慢得效果，我们必须在调用频率相同的情况想，改变每次变化的大小。</p>
<p>而每次变化的大小由TypeEvaluator计算出来，它计算的时候用到三个值，其中两个很好理解，就是我们在创建动画的时候</p>
<p>传入的开始值，和结束值。以位移动画来比喻的话就是开始位置和结束位置。最重要的一个值是fraction这个值是由Interpolator</p>
<p>计算出来的。因为每次Interpolator计算的值不同，所以导致了TypeEvaluator计算的值不同，从而导致每次刷新界面的时候</p>
<p>View的位移的值不同，因为刷新频率一定，从视觉上导致，看起来动画有了减速（或者加速）效果。</p>
<p>很重要的一点是理解Interpolator计算出来的到底是个什么东西，其实应该是<code>时间片因子</code>。</p>
<p>怎么理解呢：如果设置动画时常为500ms，系统默认的是每10ms调用一次动画变换。这个10ms叫做一个时间片。</p>
<p>也就是说这个动画会在调用50次之后结束。那么要想实现非线性变换，必须在每次调用的时候返回不同的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">/**</div><div class="line"></div><div class="line">    * Maps a value representing the elapsed fraction of an animation to a value that represents</div><div class="line"></div><div class="line">    * the interpolated fraction. This interpolated value is then multiplied by the change in</div><div class="line"></div><div class="line">    * value of an animation to derive the animated value at the current elapsed animation time.</div><div class="line"></div><div class="line">    *</div><div class="line"></div><div class="line">    * @param input A value between 0 and 1.0 indicating our current point</div><div class="line"></div><div class="line">    *        in the animation where 0 represents the start and 1.0 represents</div><div class="line"></div><div class="line">    *        the end</div><div class="line"></div><div class="line">    * @return The interpolation value. This value can be more than 1.0 for</div><div class="line"></div><div class="line">    *         interpolators which overshoot their targets, or less than 0 for</div><div class="line"></div><div class="line">    *         interpolators that undershoot their targets.</div><div class="line"></div><div class="line">    */</div><div class="line"></div><div class="line">   float getInterpolation(float input);</div></pre></td></tr></table></figure>
<p>从注释上来看，这个Interpolator接收一个0-1的参数，0表示动画的开始，1表示动画的结束。这个系数代表了动画已经完成的百分比，0意味着0%、1意味着100%。</p>
<p>比如我们上面的例子中如果设置动画时常为500ms，系统默认的是每10ms调用一次动画变换。这个10ms叫做一个时间片。</p>
<p>那么第一次调用的时候会传递：0，第二次调用传入：1.0 / (500ms/10ms)，这是线性差值器的效果，</p>
<p>所以<code>public float getInterpolation(float input)</code>此函数的本次执行的参数是上次运行的返回值；</p>
</div></article></div><div class="tags"><a href="/tags/Android/">Android</a><a href="/tags/ValueAnimator/">ValueAnimator</a></div><div class="paginator"><a href="/2015/09/01/2015-09-01-Mac Pro Mounty挂载NTFS硬盘报错/" class="prev"><i class="fa fa-chevron-left"></i><span> 上一页</span></a><a href="/2015/08/28/2015-08-28-Android属性动画之ObjectAnimator/" class="next"><span>下一页</span><i class="fa fa-chevron-right"></i></a></div></section><footer><section id="comments"><div data-thread-key="http://febsky.me/2015/08/28/2015-08-28-Android属性动画之ValueAnimator/index.html" data-title="Android属性动画之ValueAnimator" data-url="http://febsky.me/2015/08/28/2015-08-28-Android属性动画之ValueAnimator/index.html" class="ds-thread"></div><script type="text/javascript">var duoshuoQuery = {short_name: "febsky" };
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></section><div class="copyright"><p>© 2017<span class="heart"><i class="icon-next-heart fa fa-heart"></i></span><a href="http://febsky.me">Qiang</a></p></div></footer></div><label for="sidebar-toggle" class="sidebar-menu"><i class="fa fa-bars"></i></label><label class="back2top"> <a href="#top"><i class="fa fa-chevron-up"></i></a></label></body></html>