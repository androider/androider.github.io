<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Mac下Android源码（AOSP）编译环境搭建方法 · 奋斗の小鸟</title><meta name="description" content="Mac下Android源码（AOSP）编译环境搭建方法 - Qiang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css"><!-- fonts--><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="http://fonts.lug.ustc.edu.cn/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><input type="checkbox" id="sidebar-toggle"><aside><div class="author"><a href="/."><img src="/img/author.png" class="author-img"></a><h2 class="author-name">Qiang</h2></div><div class="post-toc"><span class="toc-title">Directory</span><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一、编译源码的背景环境"><span class="toc-text">一、编译源码的背景环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Android源码编译有什么困难"><span class="toc-text">Android源码编译有什么困难</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#针对上面的两点，以前有这么两种解决方式，以前有这么几种解决方式"><span class="toc-text">针对上面的两点，以前有这么两种解决方式，以前有这么几种解决方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后来有人提出用Docker"><span class="toc-text">后来有人提出用Docker</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二、搭建Mac编译环境"><span class="toc-text">二、搭建Mac编译环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#开发环境要求"><span class="toc-text">开发环境要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#我本机环境"><span class="toc-text">我本机环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#磁盘分区"><span class="toc-text">磁盘分区</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#下载Android源码"><span class="toc-text">下载Android源码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编译源码"><span class="toc-text">编译源码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动模拟器"><span class="toc-text">启动模拟器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#烧录镜像到机器中"><span class="toc-text">烧录镜像到机器中</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AndroidStudio中查看源码"><span class="toc-text">AndroidStudio中查看源码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三、错误处理"><span class="toc-text">三、错误处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#执行repo-init的错误"><span class="toc-text">执行repo init的错误</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#执行make-clobber的错误"><span class="toc-text">执行make clobber的错误</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#错误1描述："><span class="toc-text">错误1描述：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#错误2描述"><span class="toc-text">错误2描述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#错误3描述："><span class="toc-text">错误3描述：</span></a></li></ol></li></ol></li></ol></li></ol></div></aside><div class="main"><header><div id="top"><a href="/." class="logo-link">奋斗の小鸟</a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">Tags</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="/search.html" target="_self" class="nav-list-link">搜索</a></li></ul></div></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Mac下Android源码（AOSP）编译环境搭建方法</h1><div class="post-time">May 5, 2017</div><div class="post-content"><h1 id="一、编译源码的背景环境"><a href="#一、编译源码的背景环境" class="headerlink" title="一、编译源码的背景环境"></a>一、编译源码的背景环境</h1><h2 id="Android源码编译有什么困难"><a href="#Android源码编译有什么困难" class="headerlink" title="Android源码编译有什么困难"></a>Android源码编译有什么困难</h2><ol>
<li>AOSP 非常庞大，需要下载，但是他是Google家的，和大陆开发者之间隔着一个GFW</li>
<li><a href="https://source.android.com/source/initializing.html" target="_blank" rel="external">官方文档</a> 推荐使用Ubuntu 14.04进行编译。我用的是MacOS，官网也给了Mac下的编译方式，不过看起来还是挺麻烦的。而且我怕搞乱我的电脑。</li>
</ol>
<h2 id="针对上面的两点，以前有这么两种解决方式，以前有这么几种解决方式"><a href="#针对上面的两点，以前有这么两种解决方式，以前有这么几种解决方式" class="headerlink" title="针对上面的两点，以前有这么两种解决方式，以前有这么几种解决方式"></a>针对上面的两点，以前有这么两种解决方式，以前有这么几种解决方式</h2><ol>
<li>至于下载慢，可以使用国内镜像<a href="https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/" target="_blank" rel="external">清华镜像</a> 和 <a href="https://lug.ustc.edu.cn/wiki/mirrors/help/aosp" target="_blank" rel="external">科大镜像</a>，好像现在google的开发者网站部分不用梯子就可以访问了[当前时间2017-04]</li>
<li>有人使用虚拟机，然后安装Ubuntu，然后编译源码。这方式也可以，但是Mac下三种虚拟机，免费的那个还不好用。而且编译本身就比较消耗资源，再装个虚拟机就更麻烦了</li>
</ol>
<h2 id="后来有人提出用Docker"><a href="#后来有人提出用Docker" class="headerlink" title="后来有人提出用Docker"></a>后来有人提出用Docker</h2><p> 而且这个人搞了一份Docker镜像出来 <a href="https://github.com/kylemanna/docker-aosp" target="_blank" rel="external">kylemanna/docker-aosp</a>，后来有人针对Docker以及天朝的网络环境做了一部分修改，fork了一份国产的 <a href="https://github.com/tiann/docker-aosp" target="_blank" rel="external">tiann/docker-aosp</a>。主要是修改了shell脚本中的下载源。但是这个东西在MAC OS上有bug<a href="https://github.com/kylemanna/docker-aosp/issues/19" target="_blank" rel="external">issues 19</a>所以我就没用成功。</p>
<blockquote>
<p>有一点题外话需要说一下，这个Docker安装后会开机默认启动，默认启动倒是也没问题，有问题的是他不可以和Android虚拟机同时运行，就是AndroidStudio自带的那个虚拟机。</p>
</blockquote>
<h1 id="二、搭建Mac编译环境"><a href="#二、搭建Mac编译环境" class="headerlink" title="二、搭建Mac编译环境"></a>二、搭建Mac编译环境</h1><p>修改文件描述符限制<br>在<code>~/.bash_profile</code>中添加以下内容<br><figure class="highlight plain"><figcaption><span>the number of open files to be 1024 </span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ulimit -S -n 1024</div></pre></td></tr></table></figure></p>
<h2 id="开发环境要求"><a href="#开发环境要求" class="headerlink" title="开发环境要求"></a>开发环境要求</h2><ol>
<li>Mac OS v10.10 (Yosemite) 或以上，安装了 Xcode 4.5.2或以上，安装了Command Line Tools。</li>
<li>安装<a href="https://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase7-521261.html#jdk-7u71-oth-JPR" target="_blank" rel="external">JDK 7</a>。</li>
<li>安装了<a href="http://www.python.org/download/" target="_blank" rel="external">python 2.7</a></li>
<li><a href="http://ftp.gnu.org/gnu/make/" target="_blank" rel="external">GNU Make 3.81或3.82</a> </li>
<li><a href="http://git-scm.com/download" target="_blank" rel="external">Git</a></li>
</ol>
<h2 id="我本机环境"><a href="#我本机环境" class="headerlink" title="我本机环境"></a>我本机环境</h2><ol>
<li>Mac OS v10.12.4</li>
<li>xcode v8.0</li>
<li>git version 2.8.4 (Apple Git-73)</li>
<li>GNU Make 3.81</li>
<li>为了编译不同版本的Android源码，同时安装了JDK7 &amp; JDK8，通过配置<code>.bash_profile</code> 来切换</li>
<li>Python 2.7.11</li>
<li>之前我电脑还安装了homebrew </li>
</ol>
<h2 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h2><p> 为什么在Mac上编译会很麻烦呢，因为Mac的文件系统默认不区分大小写，但是Android源码编译系统的要求区分大小写，这时候我们可以创建个区分大小写的磁盘空间。方法如下：</p>
<ol>
<li>打开<code>磁盘工具</code>（在Launchpad中直接搜索就行）</li>
<li><p>如下图操作（磁盘命名为AOSP，磁盘大小为100G，磁盘格式一定要选择区分大小写） 首先选中<code>Macintosh HD</code> 然后<code>Comand + N</code><br><img src="http://upload-images.jianshu.io/upload_images/797798-4c73be3dc843ab14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="磁盘分区"></p>
<blockquote>
<p>这个磁盘分区的名字后面要用到，磁盘大小好像官网推荐70G，以防不够还是大点吧，格式一定要选<code>区分大小写</code>。这个磁盘分区还有另一种方式，我不知道这两种方式到底有什么区别。对应磁盘的分区使用，有人为了节省Mac上的硬盘，也为了防止搞坏系统，用了外接硬盘的方式然后操作这个外接硬盘的分区。</p>
</blockquote>
</li>
</ol>
<h2 id="下载Android源码"><a href="#下载Android源码" class="headerlink" title="下载Android源码"></a>下载Android源码</h2><p>下面是科大的源也可以用清华的<a href="https://lug.ustc.edu.cn/wiki/mirrors/help/aosp" target="_blank" rel="external">参考文献</a>，<strong>我下载的是Android6.0的源码，最终编译的时候选择的是x86_64</strong></p>
<ol>
<li><p>下载 repo 工具:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir ~/bin</div><div class="line">PATH=~/bin:$PATH</div><div class="line">curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo</div><div class="line">chmod a+x ~/bin/repo</div></pre></td></tr></table></figure>
</li>
<li><p>建立工作目录:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd /Volumes/AOSP/</div><div class="line">mkdir WORKING_DIRECTORY</div><div class="line">cd WORKING_DIRECTORY</div></pre></td></tr></table></figure>
</li>
<li><p>初始化仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">repo init -u git://mirrors.ustc.edu.cn/aosp/platform/manifest</div><div class="line">## 如果提示无法连接到 gerrit.googlesource.com，可以编辑 ~/bin/repo，把 REPO_URL 一行替换成下面的：</div><div class="line">## REPO_URL = &apos;https://gerrit-googlesource.proxy.ustclug.org/git-repo&apos;</div></pre></td></tr></table></figure>
<p>如果需要某个特定的 Android 版本(<a href="https://source.android.com/source/build-numbers.html#source-code-tags-and-builds" target="_blank" rel="external">Android 版本列表</a>),可以通过下面的方式指定版本号，如果不指定则代码下载当前最新的代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">repo init -u git://mirrors.ustc.edu.cn/aosp/platform/manifest -b android-6.0.1_r46</div></pre></td></tr></table></figure>
<blockquote>
<p>注：在mac上运行这行可能会报错，GnuPG 这玩意不可用，解决方式看最后错解决</p>
</blockquote>
</li>
<li><p>同步源码树（以后只需执行这条命令来同步）如果中途出现网络错误，可以停止后在执行下面的命令：</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">repo sync</div></pre></td></tr></table></figure>
<p>然后就等着吧0_0</p>
<h2 id="编译源码"><a href="#编译源码" class="headerlink" title="编译源码"></a>编译源码</h2><ol>
<li>清空缓存<br><code>$ make clobber</code><blockquote>
<p>注：如果运行这行命令出错看文章最后错误处理</p>
</blockquote>
</li>
<li>配置编译环境<br><code>$ source build/envsetup.sh</code></li>
<li><p>选择编译目标<br><code>$ lunch</code> 这时候会列出一系列的选项然后选择一个如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">You&apos;re building on Darwin</div><div class="line">Lunch menu... pick a combo:</div><div class="line">     1. aosp_arm-eng</div><div class="line">     2. aosp_arm64-eng</div><div class="line">     3. aosp_mips-eng</div><div class="line">     4. aosp_mips64-eng</div><div class="line">     5. aosp_x86-eng</div><div class="line">     6. aosp_x86_64-eng</div><div class="line">     7. full_fugu-userdebug</div><div class="line">     8. aosp_fugu-userdebug</div><div class="line">     9. mini_emulator_arm64-userdebug</div><div class="line">     10. m_e_arm-userdebug</div><div class="line">     11. m_e_mips-userdebug</div><div class="line">     12. m_e_mips64-eng</div><div class="line">     13. mini_emulator_x86-userdebug</div><div class="line">     14. mini_emulator_x86_64-userdebug</div><div class="line">     15. aosp_dragon-userdebug</div><div class="line">     16. aosp_dragon-eng</div><div class="line">     17. aosp_marlin-userdebug</div><div class="line">     18. aosp_sailfish-userdebug</div><div class="line">     19. aosp_flounder-userdebug</div><div class="line">     20. aosp_angler-userdebug</div><div class="line">     21. aosp_bullhead-userdebug</div><div class="line">     22. hikey-userdebug</div><div class="line">     23. hikey960-userdebug</div><div class="line">     24. aosp_shamu-userdebug</div><div class="line">Which would you like? [aosp_arm-eng]</div></pre></td></tr></table></figure>
<p>然后直接输入上面选项的序号就好了这里，我选择第一个，至于上面那些名字的含义是啥看下面解释：</p>
<blockquote>
<p>官网说根据上面名字的后缀可以判断要编译那种类型的：</p>
<ul>
<li><strong>user：</strong> limited access; suited for production(有限的访问权限，一般用于发布版)</li>
<li><strong>userdebug：</strong> 这个和user类似，但是可以获取root权限，并且能够调试</li>
<li><strong>eng：</strong>    具有开发配置，并且有额外的调试工具（注:工程师模式engineer）</li>
</ul>
</blockquote>
<p><strong><code>lunch</code></strong>命令也可以直接这么用 <code>$ lunch aosp_arm-eng</code></p>
</li>
<li><p>开始编译<br><code>make -j16</code>  这里指定的开启几个并行<code>task</code>来进行编译，官网建议j后面的数字根据你电脑的线程数量的1～2倍来设置，比如电脑是双核CPU，每个CPU为双核心四线程，那么就有8个线程。所以我配置的数量为16。<br>然后就是漫长的等待ing…</p>
</li>
</ol>
<h2 id="启动模拟器"><a href="#启动模拟器" class="headerlink" title="启动模拟器"></a>启动模拟器</h2><ol>
<li><code>$ source build/envsetup.sh</code></li>
<li><code>$ lunch</code> (选择刚才你设置的目标版本,我编译的是x86_64-eng的那个)</li>
<li><code>$ emulator</code>模拟器启动，这个命令有很多复杂用法，具体可参考官网。</li>
</ol>
<h2 id="烧录镜像到机器中"><a href="#烧录镜像到机器中" class="headerlink" title="烧录镜像到机器中"></a>烧录镜像到机器中</h2><p><strong>这个烧录过程我没有测试，官网是这么写的。</strong></p>
<ol>
<li>进入fastboot模式<br><code>$ adb reboot bootloader</code></li>
<li><p>把img文件刷进去<br><code>$ fastboot flashall -w</code>  这个 <code>-w</code> 是为了<code>wipes the /data partition</code>擦除<code>/data</code>分区</p>
<p><a href="https://developers.google.com/android/drivers" target="_blank" rel="external">驱动下载</a></p>
</li>
</ol>
<h2 id="AndroidStudio中查看源码"><a href="#AndroidStudio中查看源码" class="headerlink" title="AndroidStudio中查看源码"></a>AndroidStudio中查看源码</h2><p>在android源码中有这么一个目录development/tools/idegen。<br>顾名思义，是生成ide的project文件，主要是生成intellij的project文件，可用于AndroidStudio。</p>
<ol>
<li>在整个Android源码全编成功之后，然后编译idegen模块，用以生成Android studio的工程配置文件,编译成功之后就生成了idegen.jar（out/host/darwin-x86/framework/idegen.jar），运行如下命令：<br><code>$ mmm development/tools/idegen/</code><blockquote>
<p>注：如果刚才编译AOSP的那个命令行窗口关闭了，必须要在执行<code>source build/envsetup.sh</code>一次，用了初始化编译环境。</p>
</blockquote>
</li>
<li>在源码根目录生成对应的android.ipr、android.iml IEDA工程配置文件。以便于AndroidStudio可以打开项目<br><code>$ . development/tools/idegen/idegen.sh</code></li>
<li>打开Android studio，点击File –&gt; Open，选择刚刚生成的android.ipr就好了。</li>
</ol>
<h1 id="三、错误处理"><a href="#三、错误处理" class="headerlink" title="三、错误处理"></a>三、错误处理</h1><h2 id="执行repo-init的错误"><a href="#执行repo-init的错误" class="headerlink" title="执行repo init的错误"></a>执行<code>repo init</code>的错误</h2><p>错误1描述</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">warning: gpg (GnuPG) is not available.</div><div class="line">warning: Installing it is strongly encouraged.</div></pre></td></tr></table></figure>
<p>解决方法：<br>原因是GnuPG for osx没有安装，去<a href="https://www.gnupg.org/download/下载安装即可。" target="_blank" rel="external">https://www.gnupg.org/download/下载安装即可。</a><br>我用homebrew安装的<code>brew install gnupg</code></p>
<h2 id="执行make-clobber的错误"><a href="#执行make-clobber的错误" class="headerlink" title="执行make clobber的错误"></a>执行<code>make clobber</code>的错误</h2><h4 id="错误1描述："><a href="#错误1描述：" class="headerlink" title="错误1描述："></a>错误1描述：</h4> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">build/core/config.mk:660: error: Error: could not find jdk tools.jar at /System/Library/Frameworks/JavaVM.framework/Versions/A/Commands/../lib/tools.jar, please check if your JDK was installed correctly.</div><div class="line">17:29:26 ckati failed with: exit status 1</div></pre></td></tr></table></figure>
<p> 解决方式：<br> 在<code>~/.bash_profile</code>添加如下代码</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">export JAVA_8_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_111.jdk/Contents/Home</div><div class="line">export JAVA_HOME=$JAVA_8_HOME</div><div class="line">##上面是jdk的配置，主要是添加下面这一行</div><div class="line">export ANDROID_JAVA_HOME=$JAVA_HOME</div></pre></td></tr></table></figure>
<h4 id="错误2描述"><a href="#错误2描述" class="headerlink" title="错误2描述"></a>错误2描述</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">build/core/combo/mac_version.mk:38: *****************************************************</div><div class="line">build/core/combo/mac_version.mk:39: * Can not find SDK 10.6 at /Developer/SDKs/MacOSX10.6.sdk</div><div class="line">build/core/combo/mac_version.mk:40: *****************************************************</div><div class="line">build/core/combo/mac_version.mk:41: *** Stop..  Stop.</div></pre></td></tr></table></figure>
<p>解决方法：<br>出现这个错误是因为xcode的版本不对，首先查看本机安装xcode的版本，<br><code>$ cd /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/</code><br>然后修改<code>build/core/combo/mac_version.mk</code>这个文件中的下面这行，把本机的版本号添加到下面，我的是10.12 添加后如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mac_sdk_versions_supported :=  10.6 10.7 10.8 10.9 10.12</div></pre></td></tr></table></figure>
<h4 id="错误3描述："><a href="#错误3描述：" class="headerlink" title="错误3描述："></a>错误3描述：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">system/core/libcutils/threads.c:38:10: error: &apos;syscall&apos; is deprecated: first deprecated in OS X 10.12 - syscall(2) is unsupported; please switch to a supported interface. For SYS_kdebug_trace use kdebug_signpost(). [-Werror,-Wdeprecated-declarations]</div><div class="line">  return syscall(SYS_thread_selfid);</div><div class="line">         ^</div><div class="line">/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.12.sdk/usr/include/unistd.h:733:6: note: &apos;syscall&apos; has been explicitly marked deprecated here</div><div class="line">int      syscall(int, ...);</div><div class="line">         ^</div><div class="line">1 error generated.</div></pre></td></tr></table></figure>
<p>解决方式：<br>这个错误3归根到底是因为错误2引起的，再归根下是xcode版本引起的，（为啥说在mac上编译麻烦，这个xcode版本会出这么多破事），没办法这个我们上面用的mac sdk 10.12 版本太高了，这个版本废弃了某些方法导致编译不可用，那就去下个低版本的吧<a href="https://github.com/phracker/MacOSX-SDKs" target="_blank" rel="external">传送门</a>，<a href="https://github.com/phracker/MacOSX-SDKs/releases" target="_blank" rel="external">压缩包在</a>这然后下载那个10.11。理论上来说，下载后把目录放到这个路径下<code>/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/</code>和这个<code>MacOSX10.12.sdk</code>目录平级就行了，然后把错误2中添加到<code>build/core/combo/mac_version.mk</code>中的那个10.12改成10.11就好了。但是这个东西貌似在下次xcode升级的时候会被删掉。<br>a oh so? 弄个软连接:<br><code>$ mkdir ~/lib</code><br>然后把下载的压缩包解压到<code>~/lib</code>下<br><code>$ sudo ln -s ~/lib/MacOSX10.11.sdk /Applications/XCode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk</code></p>
</div></article></div><div class="tags"><a href="/tags/Android/">Android</a><a href="/tags/编译/">编译</a><a href="/tags/源码/">源码</a></div><div class="paginator"><a href="/2017/05/18/ IPC-Android中的进程与进程间通信/" class="prev"><i class="fa fa-chevron-left"></i><span> Prev</span></a><a href="/2017/03/24/2017-03-24-我的Android混淆（Proguard文件）是怎么写的/" class="next"><span>Next</span><i class="fa fa-chevron-right"></i></a></div></section><footer><section id="comments"><div data-thread-key="http://febsky.me/2017/05/05/2017-05-05-Mac下Android源码（AOSP）编译环境搭建方法/index.html" data-title="Mac下Android源码（AOSP）编译环境搭建方法" data-url="http://febsky.me/2017/05/05/2017-05-05-Mac下Android源码（AOSP）编译环境搭建方法/index.html" class="ds-thread"></div><script type="text/javascript">var duoshuoQuery = {short_name: "febsky" };
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></section><div class="copyright"><p>© 2017<span class="heart"><i class="icon-next-heart fa fa-heart"></i></span><a href="http://febsky.me">Qiang</a></p></div></footer></div><label for="sidebar-toggle" class="sidebar-menu"><i class="fa fa-bars"></i></label><label class="back2top"> <a href="#top"><i class="fa fa-chevron-up"></i></a></label></body></html>